### EK TODO: Add our own secrets! Vampirism, Lycanthropy, Necromancy, Daedra Worshipping
### EK NOTE: Leave >ONLY< Non-Vanilla effects here! Everything else goes to 00_secret_effects.txt for ease of compatching! - He9

#Scripted effects relating to secrets

#####################################################################
# EFFECT LIST
#####################################################################
# !!! Remember to add all new effects with a short description here !!!

#SECRET HANDLING
#give_necromancer_secret_or_trait_effect 	- trait if accepted, secret if not

# Necromancer
give_necromancer_secret_or_trait_effect = {
	save_temporary_scope_as = necromancer_character
	if = {
		limit = { #Not already a Necromancer
			is_necromancer = no	
		}
		if = {
			limit = {
				trait_is_criminal_in_my_or_lieges_faith_trigger = { TRAIT = necromancer GENDER_CHARACTER = scope:necromancer_character }
			}
			add_secret = {
				type = secret_necromancer
			}
			if = { 
				limit = { has_trait = experimentalist }
				remove_trait = experimentalist
			}
			add_trait = experimentalist_necromancer
		}
		else = {
			add_trait = necromancer
		}
	}	
}

reveal_necromancer_secret_effect = {
	save_temporary_scope_as = necromancer_character
	if = { 
		limit = { has_trait = experimentalist_necromancer }
		remove_trait = experimentalist_necromancer
		add_trait = necromancer
	}
	if = { 
		limit = { 
			any_secret = {
				secret_type = secret_necromancer
			}
		}
		random_secret = {
			limit = { secret_type = secret_necromancer }
			expose_secret = root
		}
	}
}

# Vampire
give_vampire_secret_or_trait_effect = {
	save_temporary_scope_as = vampire_character
	if = {
		limit = { #Not already a Vampire
			NOR = {
				has_trait = vampire_character
				any_secret = { secret_type = secret_vampire }
				has_character_flag = race_daedra # daedra cant become vampires
			}	
		}
		if = {
			limit = {
				trait_is_shunned_or_criminal_in_my_or_lieges_faith_trigger = { TRAIT = vampire_character GENDER_CHARACTER = scope:vampire_character }
			}
			add_secret = {
				type = secret_vampire
			}
			retain_visual_age_effect = yes #always do this before adding the immortality trait
			add_character_flag = vampire
			add_trait = reclusive_vampire
			add_character_modifier = secret_vampire_modifier
			substitute_lifespan_by_immortality_effect = yes #always do this after adding the immortality trait
			custom_tooltip = {
				text = ek_clear_aging_modifier_tt
				clear_aging_modifier_effect = yes
			}
		}
		else = {
			retain_visual_age_effect = yes #always do this before adding the immortality trait
			add_trait = vampire_character
			add_character_flag = vampire
			substitute_lifespan_by_immortality_effect = yes #always do this after adding the immortality trait

			custom_tooltip = {
				text = ek_clear_aging_modifier_tt
				clear_aging_modifier_effect = yes
			}
		}
	}	
}

reveal_vampire_secret_effect = {
	save_temporary_scope_as = vampire_character
	if = { 
		limit = { has_trait = reclusive_vampire }
		add_trait = vampire_character
		remove_trait = reclusive_vampire
	}
	if = { 
		limit = { has_character_modifier = secret_vampire_modifier }
		remove_character_modifier = secret_vampire_modifier
	}
	if = { 
		limit = { 
			any_secret = {
				secret_type = secret_vampire
			}
		}
		random_secret = {
			limit = { secret_type = secret_vampire }
			expose_secret = root
		}
	}
}

# Lycan
give_lycan_secret_or_trait_effect = {
	save_temporary_scope_as = lycan_character
	if = {
		limit = { #Not already a Lycan
			NOR = {
				has_trait = lycan_character
				any_secret = { secret_type = secret_lycan }
				has_character_flag = race_daedra # daedra cant become lycan??
			}	
		}
		if = {
			limit = {
				trait_is_shunned_or_criminal_in_my_or_lieges_faith_trigger = { TRAIT = lycan_character GENDER_CHARACTER = scope:lycan_character }
			}
			add_secret = {
				type = secret_lycan
			}
			add_character_flag = lycan
			add_trait = irritable_lycan
			add_character_modifier = secret_lycan_modifier
		}
		else = {
			add_trait = lycan_character
			add_character_flag = lycan
		}
	}	
}

reveal_lycan_secret_effect = {
	save_temporary_scope_as = lycan_character
	if = { 
		limit = { has_trait = irritable_lycan }
		add_trait = lycan_character
		remove_trait = irritable_lycan
	}
	if = { 
		limit = { has_character_modifier = secret_lycan_modifier }
		remove_character_modifier = secret_lycan_modifier
	}
	if = { 
		limit = { 
			any_secret = {
				secret_type = secret_lycan
			}
		}
		random_secret = {
			limit = { secret_type = secret_lycan }
			expose_secret = root
		}
	}
}

# Lich
give_lich_trait_effect = {
	save_temporary_scope_as = lich_character
	if = {
		limit = { #Not already a Lich
			NOR = {
				has_trait = lich_character
				has_character_flag = race_daedra # daedra cant become liches #1984
			}	
		}
		if = { #hard to keep this a secret now
			limit = { has_trait = experimentalist_necromancer }
			reveal_necromancer_secret_effect = yes
		}

		if = { #clear out negative effects of previous attempts
			limit = { has_character_modifier = failed_lich_ascension }
			remove_character_modifier = failed_lich_ascension
		}
		retain_visual_age_effect = yes #always do this before adding the immortality trait
		add_trait = lich_character
		add_character_flag = lich
		set_starting_decay_effect = yes
		substitute_lifespan_by_immortality_effect = yes #always do this after adding the immortality trait

		create_character_memory = {
			type = became_lich_memory
		}
	
		custom_tooltip = {
			text = ek_clear_aging_modifier_tt
			clear_aging_modifier_effect = yes
		}	
	}	
}

# Run this effect before make_character_crypto_religionist_effect in events about the Deadra 
# unless you want them to convert to a specific faith
# in those cases it's redundant
# or I guess if the Prince in question have no cultural variants to their faiths
crypto_religion_cultural_variant_effect = {
	# Azura
	if = {
		limit = { scope:daedric_prince = flag:azura }
		if = {
			limit = {
				culture = { has_cultural_pillar = heritage_khajiiti }
			}
			faith:hidden_moon = { save_scope_as = daedric_faith }
		}
		else = {
			faith:azura_cult = { save_scope_as = daedric_faith }
		}
	}
	# Boethiah, no cultural variants
	else_if = {
		limit = { scope:daedric_prince = flag:boethiah }
		faith:boethiah_cult = { save_scope_as = daedric_faith }
	}
	# Clavicus Vile, no cultural variants
	else_if = {
		limit = { scope:daedric_prince = flag:clavicus }
		faith:clavicus_cult = { save_scope_as = daedric_faith }
	}
	# Hermaeus Mora
	else_if = {
		limit = { scope:daedric_prince = flag:hermaeus }
		if = {
			limit = {
				culture = { has_cultural_pillar = heritage_atmoran }
			}
			faith:woodland_man = { save_scope_as = daedric_faith }
		}
		else = {
			faith:hermaeus_cult = { save_scope_as = daedric_faith }
		}
	}
	# Hircine - note: intentionally leaving out Minotaur Cult for the sake of simplicity
	else_if = {
		limit = { scope:daedric_prince = flag:hircine }
		if = {
			limit = {
				culture = { has_cultural_pillar = heritage_breton }
			}
			faith:glenmoril_wyrd = { save_scope_as = daedric_faith }
		}
		else_if = {
			limit = {
				culture = { 
					OR = {
						this = culture:reachfolk
						any_parent_culture_or_above = {
							this = culture:reachfolk
						}
					}
				}
			}
			faith:hircine_coven = { save_scope_as = daedric_faith }
		}
		else = {
			faith:hircine_cult = { save_scope_as = daedric_faith }
		}
	}
	# Malacath - note: intentionally leaving out Brutal Breed for the sake of simplicity
	else_if = {
		limit = { scope:daedric_prince = flag:malacath }
		if = {
			limit = {
				culture = { has_cultural_pillar = heritage_orcish }
			}
			faith:code_of_malacath = { save_scope_as = daedric_faith }
		}
		else_if = {
			limit = {
				culture = { has_cultural_pillar = heritage_goblinken }
			}
			faith:goblin_shamanism = { save_scope_as = daedric_faith }
		}
		else_if = {
			limit = {
				culture = { 
					OR = {
						this = culture:reachfolk
						any_parent_culture_or_above = {
							this = culture:reachfolk
						}
					}
				}
			}
			faith:malacath_coven = { save_scope_as = daedric_faith }
		}
		else = {
			faith:malacath_cult = { save_scope_as = daedric_faith }
		}
	}
	# Mehrunes, no cultural variants
	else_if = {
		limit = { scope:daedric_prince = flag:mehrunes }
		faith:mehrunes_cult = { save_scope_as = daedric_faith }
	}
	# Mephala, no cultural variants
	else_if = {
		limit = { scope:daedric_prince = flag:mephala }
		faith:mephala_cult = { save_scope_as = daedric_faith }
	}
	# Meridia, no cultural variants
	else_if = {
		limit = { scope:daedric_prince = flag:meridia }
		faith:meridia_cult = { save_scope_as = daedric_faith }
	}
	# Molag, no cultural variants
	else_if = {
		limit = { scope:daedric_prince = flag:molag }
		faith:molag_cult = { save_scope_as = daedric_faith }
	}
	# Namira
	else_if = {
		limit = { scope:daedric_prince = flag:namira }
		if = {
			limit = {
				culture = { has_cultural_pillar = heritage_khajiiti }
			}
			faith:darkmoondance = { save_scope_as = daedric_faith }
		}
		else_if = {
			limit = {
				culture = { 
					OR = {
						this = culture:reachfolk
						any_parent_culture_or_above = {
							this = culture:reachfolk
						}
					}
				}
			}
			faith:namira_coven = { save_scope_as = daedric_faith }
		}
		else = {
			faith:namira_cult = { save_scope_as = daedric_faith }
		}
	}
	# Nocturnal, no cultural variants
	else_if = {
		limit = { scope:daedric_prince = flag:nocturnal }
		faith:nocturnal_cult = { save_scope_as = daedric_faith }
	}
	# Peryite, no cultural variants
	else_if = {
		limit = { scope:daedric_prince = flag:peryite }
		faith:peryite_cult = { save_scope_as = daedric_faith }
	}
	# Sanguine
	else_if = {
		limit = { scope:daedric_prince = flag:sanguine }
		if = {
			limit = {
				culture = { 
					OR = {
						this = culture:yespest
						any_parent_culture_or_above = {
							this = culture:yespest
						}
					}
				}
			}
			faith:sanguine_mysteries = { save_scope_as = daedric_faith }
		}
		else_if = {
			limit = {
				culture = { has_cultural_pillar = heritage_khajiiti }
			}
			faith:blood_cat = { save_scope_as = daedric_faith }
		}
		else = {
			faith:sanguine_cult = { save_scope_as = daedric_faith }
		}
	}
	# Sheogorath
	else_if = {
		limit = { scope:daedric_prince = flag:sheogorath }
		faith:sheogorath_cult = { save_scope_as = daedric_faith }
	}
	# Vaermina
	else_if = {
		limit = { scope:daedric_prince = flag:vaermina }
		faith:vaermina_cult = { save_scope_as = daedric_faith }
	}
}
