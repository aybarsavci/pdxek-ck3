#EK NOTE: cleaned some unused effects, removed vanilla innovations
#EK DISABLED: no mongols + we delete events where it's used
# Form the actual Mongol Empire...
#form_the_greatest_khan_empire_effect

#EK DISABLED: only used in previous effect
#spawn_gok_troops_effect

mpo_gok_war_of_defiance_cleanup_effect = {
	scope:defender = {
		remove_character_modifier = aspiring_great_khan_modifier
	}
}

#EK DISABLED: used in GOK decision which we disable 
#mpo_find_powerful_opponent_for_gurkhan_effect

gok_war_of_defiance_heir_transfer_effect = {
	if = {
		limit = {
			has_variable = fought_for_gok_alone
		}
		save_scope_value_as = {
		 	name = fought_for_gok_alone_value
		 	value = var:fought_for_gok_alone
		}
		primary_heir = {
			set_variable = {
				name = fought_for_gok_alone
				value = scope:fought_for_gok_alone_value
			}
		}
	}
}

mpo_gok_offer_submission_effect = {
	#If emperor... loses titles
	if = {
		limit = {
			scope:recipient = {
				highest_held_title_tier >= tier_empire
			}
		}
		scope:recipient = {
			hidden_effect = {
				every_vassal = {
					limit = {
						highest_held_title_tier = tier_kingdom
					}
					create_title_and_vassal_change = {
						type = swear_fealty
						save_scope_as = change
					}
					change_liege = {
						liege = scope:actor
						change = scope:change
					}
					add_opinion = {
						modifier = became_vassal
						target = scope:actor
						opinion = 10
					}
					resolve_title_and_vassal_change = scope:change
				}
			}
			#Have to grant them a kingdom if they don't have any...
			if = {
				limit = {
					NOT = {
						any_held_title = {
							tier = tier_kingdom
						}
					}
				}
				if = {
					limit = {
						capital_county.kingdom ?= {
							NOT = {
								exists = holder
							}
						}
					}
					create_title_and_vassal_change = {
						type = created
						save_scope_as = change
						add_claim_on_loss = no
					}
					capital_county.kingdom = {
						change_title_holder = {
							holder = scope:recipient
							change = scope:change
						}
					}
					resolve_title_and_vassal_change = scope:change
				}
				else = {
					primary_title = {
						save_scope_as = old_title
					}
					hidden_effect = {
						#create some bullshit kingdom
						create_dynamic_title = {
							tier = kingdom
							name = GOK_SUBJECT_TITLE_NAME
							adj = GOK_SUBJECT_TITLE_NAME_ADJ
							pre = article_CONFEDERATION_CULTURE_NAME
						}
						scope:new_title = {
							set_color_from_title = scope:recipient.capital_county
							set_definitive_form = yes
							generate_coa = yes
						}
						create_title_and_vassal_change = {
							type = created
							save_scope_as = change
							add_claim_on_loss = no
						}
						scope:new_title = {
							change_title_holder = {
								holder = scope:recipient
								change = scope:change
							}
						}
						resolve_title_and_vassal_change = scope:change
					}
				}
			}
			every_held_title = {
				limit = {
					tier >= tier_empire
				}
				scope:recipient = {
					destroy_title = prev
				}
			}
		}
	}
	
	

	create_title_and_vassal_change = {
		type = swear_fealty
		save_scope_as = change
	}
	scope:recipient = {
		change_liege = {
			liege = scope:actor
			change = scope:change
		}
		hidden_effect = {
			add_opinion = {
				modifier = became_vassal
				target = scope:actor
				opinion = 10
			}
		}
	}
	resolve_title_and_vassal_change = scope:change

	#If GoK is a pluralist, they always get religious freedom
	scope:recipient = {
		if = {
			limit = {
				#Actor is still nomadic or pluralist and thus doesn't care about religion
				scope:actor = {
					faith = {
						has_doctrine = doctrine_pluralism_pluralistic
					}
				}
				OR = {
					government_has_flag = government_is_feudal
					government_has_flag = government_is_clan
				}
			}
			hidden_effect = {
				if = {
					limit = { is_independent_ruler = no } # To avoid errors during tooltip generation (prior to the contract being generated)
					vassal_contract_set_obligation_level = { type = religious_rights level = 1 }
				}
			}
			custom_tooltip = religious_protection_tt
		}
	}

	# Special terms for feudal contracts
	scope:recipient = {
		if = {
			limit = {
				government_has_flag = government_is_feudal
			}
			if = {
				limit = {
					scope:send_tribute = yes
				}
				hidden_effect = {
					if = {
						limit = { is_independent_ruler = no } # To avoid errors during tooltip generation (prior to the contract being generated)
						vassal_contract_set_obligation_level = { type = feudal_government_taxes level = 3 }
						vassal_contract_set_obligation_level = { type = feudal_government_levies level = 3 }
					}
				}
				custom_tooltip = high_obligations_taxes
				custom_tooltip = high_obligations_levies
			}
			else_if = {
				limit = { scope:low_obligations = yes }
				hidden_effect = {
					if = {
						limit = { is_independent_ruler = no } # To avoid errors during tooltip generation (prior to the contract being generated)
						vassal_contract_set_obligation_level = { type = feudal_government_taxes level = 1 }
						vassal_contract_set_obligation_level = { type = feudal_government_levies level = 1 }
					}
				}
				custom_tooltip = low_obligations_taxes
				custom_tooltip = low_obligations_levies
			}
			else = {
				hidden_effect = {
					if = {
						limit = { is_independent_ruler = no } # To avoid errors during tooltip generation (prior to the contract being generated)
						vassal_contract_set_obligation_level = { type = feudal_government_taxes level = 2 }
						vassal_contract_set_obligation_level = { type = feudal_government_levies level = 2 }
					}
				}
				custom_tooltip = normal_obligations_taxes
				custom_tooltip = normal_obligations_levies
			}
		}
		else_if = {
			limit = {
				government_has_flag = government_is_nomadic
			}
			if = {
				limit = {
					scope:send_tribute = yes
				}
				hidden_effect = {
					if = {
						limit = { is_independent_ruler = no } # To avoid errors during tooltip generation (prior to the contract being generated)
						vassal_contract_set_obligation_level = { type = nomad_government_herd level = 3 }
					}
				}
				custom_tooltip = high_obligations_herds
			}
			else_if = {
				limit = { scope:low_obligations = yes }
				hidden_effect = {
					if = {
						limit = { is_independent_ruler = no } # To avoid errors during tooltip generation (prior to the contract being generated)
						vassal_contract_set_obligation_level = { type = nomad_government_herd level = 1 }
					}
				}
				custom_tooltip = low_obligations_herds
			}
			else = {
				hidden_effect = {
					if = {
						limit = { is_independent_ruler = no } # To avoid errors during tooltip generation (prior to the contract being generated)
						vassal_contract_set_obligation_level = { type = nomad_government_herd level = 2 }
					}
				}
				custom_tooltip = normal_obligations_herds
			}
		}
		#Demand payments payments
		#Costs more for those who aren't paying increased taxes
		if = {
			limit = {
				NOR = {
					government_has_flag = government_is_feudal
					government_has_flag = government_is_nomadic
					government_has_flag = government_is_herder
				}
			}
			if = {	
				limit = {
					scope:send_tribute = yes
				}
				pay_short_term_gold = {
					target = scope:actor
					gold = monumental_gold_value
				}
			}
			else_if = {	
				limit = {
					NOT = { scope:low_obligations = yes }
				}
				pay_short_term_gold = {
					target = scope:actor
					gold = major_gold_value
				}
			}
		}
		else_if = {
			limit = {
				government_has_flag = government_is_nomadic
				scope:send_tribute = yes
			}
			pay_herd = {
				target = scope:actor
				value = domicile.massive_herd_value
			}
		}
		else_if = {
			limit = {
				scope:send_tribute = yes
			}
			pay_short_term_gold = {
				target = scope:actor
				gold = massive_gold_value
			}
		}
		#special soldiers
		#Pay some gold or herd to signify giving them up
		if = {
			limit = {
				OR = {
					scope:send_army = yes
					scope:send_siege_weapons = yes
				}
			}
			if = {
				limit = {
					government_has_flag = government_is_nomadic
				}
				domicile = {
					change_herd = medium_herd_loss
				}
			}
			else_if = {
				limit = {
					government_has_flag = government_is_tribal
				}
				add_prestige = medium_prestige_loss
			}
			else = {
				remove_short_term_gold = medium_gold_value
			}
		}
		if = {
			limit = {
				scope:send_army = yes
			}
			scope:actor = {
				gok_spawn_subjugated_quality_army_effect = { CHARACTER = scope:recipient }
			}
		}
		if = {
			limit = {
				scope:send_siege_weapons = yes
			}
			scope:actor = {
				gok_spawn_subjugated_siege_army_effect = { CHARACTER = scope:recipient }
			}
		}
	}

	# Struggle catalysts.
	hidden_effect = {
		fp3_struggle_apply_independent_vassalage_catalyst_effect = {
			NEW_LIEGE = scope:actor
			NEW_VASSAL = scope:recipient
		}
	}
}

mpo_gok_offer_submission_refusal_effect = {
	save_scope_as = actor
	start_war = {
		cb = mpo_gok_onslaught_cb
		target = scope:recipient
		target_title = scope:recipient.primary_title
	}
	custom_tooltip = gok_on_victory_tt
	show_as_tooltip = {
		rightfully_imprison_character_less_verbose_effect = { 
			TARGET = scope:recipient
			IMPRISONER = scope:actor
		}
	}
	custom_tooltip = gok_ruin_additional_destruction_tt
	custom_tooltip = gok_gain_dread_tt
	if = {
		limit = {
			government_has_flag = government_is_nomadic
			scope:recipient.capital_county = {
				any_county_province = {
					OR = {
						has_holding_type = nomad_holding
						has_holding_type = herder_holding
					}
				}
			}
		}
		custom_tooltip = gok_gain_herd_tt
	}
	else = {
		custom_tooltip = gok_gain_gold_tt
	}
	if = {
		limit = {
			scope:send_army = yes
		}
		save_scope_as = requested_quality_army
		custom_tooltip = gok_cb_event_troops_quality_tt
	}
	else_if = {
		limit = {
			scope:send_siege_weapons = yes
		}
		save_scope_as = requested_siege_army
		custom_tooltip = gok_cb_event_troops_siege_tt
	}
	else = {
		custom_tooltip = gok_cb_event_troops_tt
	}
	
	custom_tooltip = gok_offer_submission_acceptance_bonus_tt
	scope:recipient.primary_title = {
		set_variable = {
			name = refused_submission
			value = yes
		}
	}
}

gok_spawn_subjugated_siege_army_effect = {
	$CHARACTER$ = { save_scope_as = army_giver }
	custom_tooltip = gok_siege_army_gain_tt
	if = {
		limit = {
			exists = $CHARACTER$.primary_title
		}
		$CHARACTER$.primary_title = {
			save_scope_as = army_origin_realm
		}
	}
	else = {
		$CHARACTER$.location.county.kingdom = {
			save_scope_as = army_origin_realm
		}
	}
	hidden_effect = {
		if = {
			limit = {
				OR = {
					$CHARACTER$.culture = {
						has_innovation = innovation_bombard
					}
					$CHARACTER$.capital_county.culture ?= {
						has_innovation = innovation_bombard
					}
				}
			}
			random_list = {
				#Heavy Infantry
				1 = {
					trigger = {
						OR = {
							$CHARACTER$.culture = {
								has_innovation = innovation_quilted_armor
							}
							$CHARACTER$.capital_county.culture ?= {
								has_innovation = innovation_quilted_armor
							}
						}
					}
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = heavy_infantry
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_heavy_infantry_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_heavy_infantry_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = armored_footmen
							stacks = gok_subjugated_army_maa_value_very_small
						}
						men_at_arms = {
							type = bombard
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Pikemen
				1 = {
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = pikemen
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_pikemen_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_pikemen_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = pikemen_unit
							stacks = gok_subjugated_army_maa_value_very_small
						}
						men_at_arms = {
							type = bombard
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Crossbowmen
				1 = {
					trigger = {
						OR = {
							$CHARACTER$.culture = {
								has_innovation = innovation_advanced_bowmaking
							}
							$CHARACTER$.capital_county.culture ?= {
								has_innovation = innovation_advanced_bowmaking
							}
						}
					}
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_type = {
								type = crossbowmen
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_archer_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_archer_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = crossbowmen
							stacks = gok_subjugated_army_maa_value_very_small
						}
						men_at_arms = {
							type = bombard
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Light Cavalry
				1 = {
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = light_cavalry
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_light_cavalry_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_light_cavalry_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = light_horsemen
							stacks = gok_subjugated_army_maa_value_very_small
						}
						men_at_arms = {
							type = bombard
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Bowmen
				1 = {
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = archers
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_archer_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_archer_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = bowmen
							stacks = gok_subjugated_army_maa_value_small
						}
						men_at_arms = {
							type = bombard
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Light Footmen
				1 = {
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = skirmishers
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_skirmisher_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_skirmisher_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = light_footmen
							stacks = gok_subjugated_army_maa_value_small
						}
						men_at_arms = {
							type = bombard
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
			}
		}
		else_if = {
			limit = {
				OR = {
					$CHARACTER$.culture = {
						has_innovation = innovation_trebuchet
					}
					$CHARACTER$.capital_county.culture ?= {
						has_innovation = innovation_trebuchet
					}
				}
			}
			random_list = {
				#Heavy Infantry
				1 = {
					trigger = {
						OR = {
							$CHARACTER$.culture = {
								has_innovation = innovation_quilted_armor
							}
							$CHARACTER$.capital_county.culture ?= {
								has_innovation = innovation_quilted_armor
							}
						}
					}
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = heavy_infantry
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_heavy_infantry_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_heavy_infantry_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = armored_footmen
							stacks = gok_subjugated_army_maa_value_very_small
						}
						men_at_arms = {
							type = trebuchet
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Pikemen
				1 = {
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = pikemen
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_pikemen_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_pikemen_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = pikemen_unit
							stacks = gok_subjugated_army_maa_value_very_small
						}
						men_at_arms = {
							type = trebuchet
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Crossbowmen
				1 = {
					trigger = {
						OR = {
							$CHARACTER$.culture = {
								has_innovation = innovation_advanced_bowmaking
							}
							$CHARACTER$.capital_county.culture ?= {
								has_innovation = innovation_advanced_bowmaking
							}
						}
					}
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_type = {
								type = crossbowmen
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_archer_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_archer_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = crossbowmen
							stacks = gok_subjugated_army_maa_value_very_small
						}
						men_at_arms = {
							type = trebuchet
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Light Cavalry
				1 = {
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = light_cavalry
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_light_cavalry_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_light_cavalry_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = light_horsemen
							stacks = gok_subjugated_army_maa_value_very_small
						}
						men_at_arms = {
							type = trebuchet
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Bowmen
				1 = {
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = archers
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_archer_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_archer_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = bowmen
							stacks = gok_subjugated_army_maa_value_small
						}
						men_at_arms = {
							type = trebuchet
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Light Footmen
				1 = {
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = skirmishers
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_skirmisher_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_skirmisher_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = light_footmen
							stacks = gok_subjugated_army_maa_value_small
						}
						men_at_arms = {
							type = trebuchet
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
			}
		}
		
		else_if = {
			limit = {
				OR = {
					$CHARACTER$.culture = {
						has_innovation = innovation_mangonel
					}
					$CHARACTER$.capital_county.culture ?= {
						has_innovation = innovation_mangonel
					}
				}
			}
			random_list = {
				#Heavy Infantry
				1 = {
					trigger = {
						OR = {
							$CHARACTER$.culture = {
								has_innovation = innovation_quilted_armor
							}
							$CHARACTER$.capital_county.culture ?= {
								has_innovation = innovation_quilted_armor
							}
						}
					}
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = heavy_infantry
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_heavy_infantry_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_heavy_infantry_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = armored_footmen
							stacks = gok_subjugated_army_maa_value_very_small
						}
						men_at_arms = {
							type = mangonel
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Pikemen
				1 = {
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = pikemen
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_pikemen_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_pikemen_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = pikemen_unit
							stacks = gok_subjugated_army_maa_value_very_small
						}
						men_at_arms = {
							type = mangonel
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Crossbowmen
				1 = {
					trigger = {
						OR = {
							$CHARACTER$.culture = {
								has_innovation = innovation_advanced_bowmaking
							}
							$CHARACTER$.capital_county.culture ?= {
								has_innovation = innovation_advanced_bowmaking
							}
						}
					}
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_type = {
								type = crossbowmen
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_archer_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_archer_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = crossbowmen
							stacks = gok_subjugated_army_maa_value_very_small
						}
						men_at_arms = {
							type = mangonel
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Light Cavalry
				1 = {
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = light_cavalry
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_light_cavalry_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_light_cavalry_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = light_horsemen
							stacks = gok_subjugated_army_maa_value_very_small
						}
						men_at_arms = {
							type = mangonel
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Bowmen
				1 = {
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = archers
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_archer_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_archer_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = bowmen
							stacks = gok_subjugated_army_maa_value_small
						}
						men_at_arms = {
							type = mangonel
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Light Footmen
				1 = {
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = skirmishers
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_skirmisher_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_skirmisher_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = light_footmen
							stacks = gok_subjugated_army_maa_value_small
						}
						men_at_arms = {
							type = mangonel
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
			}
		}
		else = {
			random_list = {
				#Heavy Infantry
				1 = {
					trigger = {
						OR = {
							$CHARACTER$.culture = {
								has_innovation = innovation_quilted_armor
							}
							$CHARACTER$.capital_county.culture ?= {
								has_innovation = innovation_quilted_armor
							}
						}
					}
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = heavy_infantry
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_heavy_infantry_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_heavy_infantry_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = armored_footmen
							stacks = gok_subjugated_army_maa_value_very_small
						}
						men_at_arms = {
							type = onager
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Pikemen
				1 = {
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = pikemen
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_pikemen_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_pikemen_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = pikemen_unit
							stacks = gok_subjugated_army_maa_value_very_small
						}
						men_at_arms = {
							type = onager
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Crossbowmen
				1 = {
					trigger = {
						OR = {
							$CHARACTER$.culture = {
								has_innovation = innovation_advanced_bowmaking
							}
							$CHARACTER$.capital_county.culture ?= {
								has_innovation = innovation_advanced_bowmaking
							}
						}
					}
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_type = {
								type = crossbowmen
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_archer_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_archer_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = crossbowmen
							stacks = gok_subjugated_army_maa_value_very_small
						}
						men_at_arms = {
							type = onager
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Light Cavalry
				1 = {
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = light_cavalry
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_light_cavalry_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_light_cavalry_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = light_horsemen
							stacks = gok_subjugated_army_maa_value_very_small
						}
						men_at_arms = {
							type = onager
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Bowmen
				1 = {
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = archers
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_archer_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_archer_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = bowmen
							stacks = gok_subjugated_army_maa_value_small
						}
						men_at_arms = {
							type = onager
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
				#Light Footmen
				1 = {
					modifier = {
						$CHARACTER$ = {
							number_maa_regiments_of_base_type = {
								type = skirmishers
								value > 0
							}
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.culture = {
							culture_specializes_in_skirmisher_maa = yes
						}
						add = 10
					}
					modifier = {
						$CHARACTER$.capital_county.culture ?= {
							culture_specializes_in_skirmisher_maa = yes
						}
						add = 10
					}
					spawn_army = {
						name = gok_subjugated_army_name_subject_troops
						inheritable = yes
						uses_supply = no
						
						men_at_arms = {
							type = light_footmen
							stacks = gok_subjugated_army_maa_value_small
						}
						men_at_arms = {
							type = onager
							stacks = gok_subjugated_army_maa_value_small
						}
						location = scope:gok.capital_province
						origin = $CHARACTER$.capital_province
					}
				}
			}
		}
	}
}

gok_spawn_subjugated_quality_army_effect = {
	$CHARACTER$ = {
		save_scope_as = army_giver
	}
	custom_tooltip = gok_quality_army_gain_tt
	if = {
		limit = {
			exists = $CHARACTER$.primary_title
		}
		$CHARACTER$.primary_title = {
			save_scope_as = army_origin_realm
		}
	}
	else = {
		$CHARACTER$.location.county.kingdom = {
			save_scope_as = army_origin_realm
		}
	}
	hidden_effect = {
		random_list = {
			#EK DISABLED: removed vanilla maa effects
			#WAR ELEPHANTS... I mean, come on
			200 = {
				trigger = {
					scope:army_giver = {
						OR = {
							culture = {
								has_innovation = innovation_elephantry
							}
							capital_county.culture = {
								has_innovation = innovation_elephantry
							}
						}
					}
				}

				spawn_army = {
					name = gok_subjugated_army_name_subject_troops
					uses_supply = no
					inheritable = yes
					
					men_at_arms = {
						type = war_elephant
						stacks = gok_subjugated_army_maa_value_very_small
					}
					location = scope:gok.capital_province
					origin = $CHARACTER$.capital_province
				}
			}

			#Mountaineers

			#Palace Guards

			#Bondi

			#Vigmen

			#Tarkhans

			#Tawashi

			#Zupin Spearmen

			#WARBAND
			#Bush Hunters

			#Horn Warriors

			#Metsanvartija

			#Greeks
			
			#Armenians
			
			#Georgians
			
			#Cataphract archers
			
			#Konni folk get konni
			
			#Varangians
			
			#Horse archers
			2 = {
				trigger = {
					OR = {
						scope:army_giver = {
							capital_county = {
								culture = {
									culture_has_archer_cavalry_maa = yes
								}
							}
						}
						scope:army_giver = {
							any_vassal = {
								OR = {
									culture = { culture_has_archer_cavalry_maa = yes }
									mpo_can_recruit_nomad_maa_trigger = yes
								}
							}
						}
						scope:army_giver = {
							OR = {
								culture = { culture_has_archer_cavalry_maa = yes }
								mpo_can_recruit_nomad_maa_trigger = yes
							}
						}
					}
				}
				if = {
					limit = {
						scope:army_giver = {
							capital_county = {
								culture = {
									culture_has_archer_cavalry_maa = yes
								}
							}
						}
					}
					scope:army_giver = {
						capital_county = {
							culture = { save_scope_as = army_culture }
						}
					}
				}
				else_if = {
					limit = {
						scope:army_giver = {
							OR = {
								culture = { culture_has_archer_cavalry_maa = yes }
								mpo_can_recruit_nomad_maa_trigger = yes
							}
						}
					}
					scope:army_giver = {
						culture = {
							save_scope_as = army_culture
						}
					}
				}
				else_if = {
					limit = {
						scope:army_giver = {
							any_vassal = {
								OR = {
									culture = { culture_has_archer_cavalry_maa = yes }
									mpo_can_recruit_nomad_maa_trigger = yes
								}
							}
						}
					}
					scope:army_giver = {
						random_vassal = {
							limit = {
								OR = {
									culture = { culture_has_archer_cavalry_maa = yes }
									mpo_can_recruit_nomad_maa_trigger = yes
								}
							}
							culture = { save_scope_as = army_culture }
						}
					}
				}
				else = {
					culture = {
						save_scope_as = army_culture
					}
				}
				spawn_army = {
					name = greek_anarchy_war_nomad_army_name
					uses_supply = no
					inheritable = yes
					
					men_at_arms = {
						type = horse_archers
						stacks = gok_subjugated_army_maa_value_large
					}
					location = scope:gok.capital_province
					origin = $CHARACTER$.capital_province
				}
			}
			#Crossbowmen
			5 = {
				trigger = {
					OR = {
						scope:army_giver = {
							culture = {
								OR = {
									has_innovation = innovation_advanced_bowmaking
									#EK EDIT: we don't use this
									#has_innovation = innovation_repeating_crossbow
								}
							}
						}
						scope:army_giver = {
							capital_county = {
								culture = {
									OR = {
										has_innovation = innovation_advanced_bowmaking
										#EK EDIT: we don't use this
										#has_innovation = innovation_repeating_crossbow
									}
								}
							}
						}
					}
				}
				modifier = {
					$CHARACTER$ = {
						number_maa_regiments_of_type = {
							type = crossbowmen
							value > 0
						}
					}
					add = 2
				}
				modifier = {
					$CHARACTER$.culture = {
						culture_specializes_in_archer_maa = yes
					}
					add = 2
				}
				modifier = {
					$CHARACTER$.capital_county.culture ?= {
						culture_specializes_in_archer_maa = yes
					}
					add = 2
				}
				spawn_army = {
					name = gok_subjugated_army_name_subject_troops
					uses_supply = no
					inheritable = yes
					
					men_at_arms = {
						type = crossbowmen
						stacks = gok_subjugated_army_maa_value_large
					}
					location = scope:gok.capital_province
					origin = $CHARACTER$.capital_province
				}
			}
			#Norman knights
			
			#Huscarls
			
			#Camels
			3 = {
				trigger = {
					OR = {
						scope:army_giver = {
							capital_county = {
								culture = {
									has_innovation = innovation_war_camels
								}
								any_county_province = {
									OR = {
										terrain = drylands
										terrain = desert
									}
								}
							}
						}
					}
				}
				if = {
					limit = {
						scope:army_giver = {
							capital_county = {
								culture = {
									has_innovation = innovation_war_camels
								}
								any_county_province = {
									OR = {
										terrain = drylands
										terrain = desert
									}
								}
							}
						}
					}
					scope:army_giver = {
						capital_county = {
							culture = {
								save_scope_as = army_culture
							}
						}
					}
				}
				else = {
					culture = {
						save_scope_as = army_culture
					}
				}
				spawn_army = {
					name = greek_anarchy_war_nomad_army_name
					uses_supply = no
					inheritable = yes
					
					men_at_arms = {
						type = camel_rider
						stacks = gok_subjugated_army_maa_value_large
					}
					location = scope:gok.capital_province
					origin = $CHARACTER$.capital_province
				}
			}
			#Heavy cav
			3 = {
				trigger = {
					OR = {
						scope:army_giver = {
							culture = {
								has_innovation = innovation_arched_saddle
							}
						}
						scope:army_giver = {
							capital_county = {
								culture = {
									has_innovation = innovation_arched_saddle
								}
							}
						}
					}
					scope:army_giver = {
						highest_held_title_tier >= tier_kingdom
					}
					OR = {
						scope:army_giver = {
							NOT = {
								government_has_flag = government_is_nomadic
							}
						}
						scope:army_giver = {
							capital_county = {
								NOT = {
									any_county_province = {
										OR = {
											has_holding_type = nomad_holding
											has_holding_type = herder_holding
										}
									}
								}
							}
						}
					}
				}
				modifier = {
					$CHARACTER$ = {
						number_maa_regiments_of_base_type = {
							type = heavy_cavalry
							value > 0
						}
					}
					add = 2
				}
				modifier = {
					$CHARACTER$.culture = {
						culture_specializes_in_heavy_cavalry_maa = yes
					}
					add = 2
				}
				modifier = {
					$CHARACTER$.capital_county.culture ?= {
						culture_specializes_in_heavy_cavalry_maa = yes
					}
					add = 2
				}
				spawn_army = {
					name = gok_subjugated_army_name_subject_troops
					inheritable = yes
					uses_supply = no
					
					men_at_arms = {
						type = armored_horsemen
						stacks = gok_subjugated_army_maa_value_small
					}
					location = scope:gok.capital_province
					origin = $CHARACTER$.capital_province
				}
			}
			#Heavy Infantry
			1 = {
				trigger = {
					OR = {
						scope:army_giver = {
							culture = {
								has_innovation = innovation_quilted_armor
							}
						}
						scope:army_giver = {
							capital_county = {
								culture = {
									has_innovation = innovation_quilted_armor
								}
							}
						}
					}
					OR = {
						scope:army_giver = {
							NOT = {
								government_has_flag = government_is_nomadic
							}
						}
						scope:army_giver = {
							capital_county = {
								NOT = {
									any_county_province = {
										OR = {
											has_holding_type = nomad_holding
											has_holding_type = herder_holding
										}
									}
								}
							}
						}
					}
				}
				modifier = {
					$CHARACTER$ = {
						number_maa_regiments_of_base_type = {
							type = heavy_infantry
							value > 0
						}
					}
					add = 2
				}
				modifier = {
					$CHARACTER$.culture = {
						culture_specializes_in_heavy_infantry_maa = yes
					}
					add = 2
				}
				modifier = {
					$CHARACTER$.capital_county.culture ?= {
						culture_specializes_in_heavy_infantry_maa = yes
					}
					add = 2
				}
				spawn_army = {
					name = gok_subjugated_army_name_subject_troops
					inheritable = yes
					uses_supply = no
					
					men_at_arms = {
						type = armored_footmen
						stacks = gok_subjugated_army_maa_value_large
					}
					location = scope:gok.capital_province
					origin = $CHARACTER$.capital_province
				}
			}
			#Pikemen
			1 = {
				trigger = {
					scope:army_giver = {
						capital_county = {
							any_county_province = {
								terrain = mountains
							}
						}
					}
					OR = {
						scope:army_giver = {
							NOT = {
								government_has_flag = government_is_nomadic
							}
						}
						scope:army_giver = {
							capital_county = {
								NOT = {
									any_county_province = {
										OR = {
											has_holding_type = nomad_holding
											has_holding_type = herder_holding
										}
									}
								}
							}
						}
					}
				}
				modifier = {
					$CHARACTER$ = {
						number_maa_regiments_of_base_type = {
							type = pikemen
							value > 0
						}
					}
					add = 2
				}
				modifier = {
					$CHARACTER$.culture = {
						culture_specializes_in_pikemen_maa = yes
					}
					add = 2
				}
				modifier = {
					$CHARACTER$.capital_county.culture ?= {
						culture_specializes_in_pikemen_maa = yes
					}
					add = 2
				}
				spawn_army = {
					name = gok_subjugated_army_name_subject_troops
					inheritable = yes
					uses_supply = no
					
					men_at_arms = {
						type = pikemen_unit
						stacks = gok_subjugated_army_maa_value_large
					}
					location = scope:gok.capital_province
					origin = $CHARACTER$.capital_province
				}
			}
			#Archers
			1 = {
				trigger = {
					scope:army_giver = {
						capital_county = {
							any_county_province = {
								terrain = forest
							}
						}
					}
					OR = {
						scope:army_giver = {
							NOT = {
								government_has_flag = government_is_nomadic
							}
						}
						scope:army_giver = {
							capital_county = {
								NOT = {
									any_county_province = {
										OR = {
											has_holding_type = nomad_holding
											has_holding_type = herder_holding
										}
									}
								}
							}
						}
					}
				}
				modifier = {
					$CHARACTER$ = {
						number_maa_regiments_of_base_type = {
							type = archers
							value > 0
						}
					}
					add = 2
				}
				modifier = {
					$CHARACTER$.culture = {
						culture_specializes_in_archer_maa = yes
					}
					add = 2
				}
				modifier = {
					$CHARACTER$.capital_county.culture ?= {
						culture_specializes_in_archer_maa = yes
					}
					add = 2
				}
				spawn_army = {
					name = gok_subjugated_army_name_subject_troops
					inheritable = yes
					uses_supply = no
					
					men_at_arms = {
						type = bowmen
						stacks = gok_subjugated_army_maa_value_very_large
					}
					location = scope:gok.capital_province
					origin = $CHARACTER$.capital_province
				}
			}
			#Light Horsemen
			1 = {
				trigger = {
					OR = {
						scope:army_giver = {
							NOT = {
								government_has_flag = government_is_nomadic
							}
						}
						scope:army_giver = {
							capital_county = {
								NOT = {
									any_county_province = {
										OR = {
											has_holding_type = nomad_holding
											has_holding_type = herder_holding
										}
									}
								}
							}
						}
					}
				}
				modifier = {
					$CHARACTER$ = {
						number_maa_regiments_of_base_type = {
							type = light_cavalry
							value > 0
						}
					}
					add = 2
				}
				modifier = {
					$CHARACTER$.culture = {
						culture_specializes_in_light_cavalry_maa = yes
					}
					add = 2
				}
				modifier = {
					$CHARACTER$.capital_county.culture ?= {
						culture_specializes_in_light_cavalry_maa = yes
					}
					add = 2
				}
				spawn_army = {
					name = gok_subjugated_army_name_subject_troops
					inheritable = yes
					uses_supply = no
					
					men_at_arms = {
						type = light_horsemen
						stacks = gok_subjugated_army_maa_value_large
					}
					location = scope:gok.capital_province
					origin = $CHARACTER$.capital_province
				}
			}
			#Light Footmen
			1 = {
				trigger = {
					OR = {
						scope:army_giver = {
							NOT = {
								government_has_flag = government_is_nomadic
							}
						}
						scope:army_giver = {
							capital_county = {
								NOT = {
									any_county_province = {
										OR = {
											has_holding_type = nomad_holding
											has_holding_type = herder_holding
										}
									}
								}
							}
						}
					}
				}
				modifier = {
					$CHARACTER$ = {
						number_maa_regiments_of_base_type = {
							type = skirmishers
							value > 0
						}
					}
					add = 2
				}
				modifier = {
					$CHARACTER$.culture = {
						culture_specializes_in_skirmisher_maa = yes
					}
					add = 2
				}
				modifier = {
					$CHARACTER$.capital_county.culture ?= {
						culture_specializes_in_skirmisher_maa = yes
					}
					add = 2
				}
				spawn_army = {
					name = gok_subjugated_army_name_subject_troops
					inheritable = yes
					uses_supply = no
					
					men_at_arms = {
						type = light_footmen
						stacks = gok_subjugated_army_maa_value_very_large
					}
					location = scope:gok.capital_province
					origin = $CHARACTER$.capital_province
				}
			}
			#Steppe Raiders
			2 = {
				trigger = {
					scope:army_giver = {
						mpo_can_recruit_nomad_maa_trigger = yes
					}
				}
				scope:army_giver.culture = { save_scope_as = army_culture }

				spawn_army = {
					name = greek_anarchy_war_nomad_army_name
					uses_supply = no
					inheritable = yes
					
					men_at_arms = {
						type = steppe_raiders
						stacks = gok_subjugated_army_maa_value_large
					}
					location = scope:gok.capital_province
					origin = $CHARACTER$.capital_province
				}
			}
			#Heavy Horse Archers
			10 = {
				trigger = {
					scope:army_giver = {
						exists = domicile
						domicile = {
							has_domicile_parameter = unlock_maa_heavy_horse_archers
						}
					}
				}
				scope:army_giver.culture = { save_scope_as = army_culture }

				spawn_army = {
					name = greek_anarchy_war_nomad_army_name
					uses_supply = no
					inheritable = yes
					
					men_at_arms = {
						type = heavy_horse_archers
						stacks = gok_subjugated_army_maa_value_medium
					}
					location = scope:gok.capital_province
					origin = $CHARACTER$.capital_province
				}
			}
			#Nomad Lancers
			2 = {
				trigger = {
					scope:army_giver = {
						mpo_can_recruit_nomad_maa_trigger = yes
						highest_held_title_tier >= tier_duchy
					}
				}
				scope:army_giver.culture = { save_scope_as = army_culture }

				spawn_army = {
					name = mpo_war_nomad_army_name
					uses_supply = no
					inheritable = yes
					
					men_at_arms = {
						type = nomad_lancers
						stacks = gok_subjugated_army_maa_value_small
					}
					location = scope:gok.capital_province
					origin = $CHARACTER$.capital_province
				}
			}
			#Mangudai
			
			#Maturkan Warriors
		}
	}
}

gok_realm_devastation_effect = {
	#Minor issues targeting the general realm, but REALLY focus in on the capital area for revenge
	add_to_list = defender_realm_vassals
	#defender domain specifically targeted
	every_in_list = {
		list = target_titles
		limit = {
			tier = tier_county
			is_landless_type_title = no
		}
		add_to_list = devastation_area
	}
	#and area of capital
	capital_county.duchy = {
		every_de_jure_county = {
			limit = {
				holder = {
					top_liege = scope:defender
					NOR = {
						is_ai = no
						is_at_war_with = scope:defender
					}
				}
			}
			add_to_list = devastation_area
		}
	}
	every_vassal_or_below = {
		add_to_list = defender_realm_vassals
	}
	#is this violent retribution for refusing the khan's generosity?
	if = {
		limit = {
			exists = scope:khans_retribution_target
		}
		scope:attacker = {
			custom_tooltip = gok_gain_dread_tt
		}
		custom_tooltip = gok_ruin_additional_destruction_tt
		if = {
			limit = {
				government_has_flag = government_is_nomadic
				scope:defender.capital_county = {
					any_county_province = {
						OR = {
							has_holding_type = nomad_holding
							has_holding_type = herder_holding
						}
					}
				}
			}
			scope:attacker = {
				custom_tooltip = gok_gain_herd_tt
			}
		}
		else = {
			scope:attacker = {
				custom_tooltip = gok_gain_gold_tt
			}
		}
		hidden_effect = {
			scope:attacker = {
				#First off, gain dread
				add_dread = gok_retribution_dread_value
				#Gain herd or gold
				if = {
					limit = {
						government_has_flag = government_is_nomadic
						scope:defender.capital_county = {
							any_county_province = {
								OR = {
									has_holding_type = nomad_holding
									has_holding_type = herder_holding
								}
							}
						}
					}
					domicile = {
						change_herd = gok_retribution_herd_value
					}
				}
				else = {
					add_short_term_gold = gok_retribution_gold_value
				}
			}
			#Tank control everywhere
			every_sub_realm_county = {
				limit = {
					NOT = {
						is_in_list = devastation_area
					}
				}
				change_county_control = massive_county_control_loss
				change_development_level = {
					subtract = development_level
					multiply = 0.2
					floor = yes
				}
			}
			#Destroy the holdings
			every_in_list = {
				list = devastation_area
				limit = {
					any_county_province = {
						has_holding = yes
						is_county_capital = no
					}
				}
				every_county_province = {
					limit = {
						has_holding = yes
						is_county_capital = no
					}
					random = {
						chance = 50
						remove_holding = yes
						add_to_list = destroyed_holdings
					}
					
				}
			}

			scope:attacker = {
				save_scope_as = mongol_emperor
			}
			#Kick the shit out of capital area
			every_in_list = {
				list = devastation_area
				save_scope_as = county
				
				change_county_control = massive_county_control_loss
				holder = {
					send_interface_message = {
						type = event_war_bad
						title = mongols_sieged_county.t
						left_icon = scope:mongol_emperor
						right_icon = scope:county

						scope:county = {
							change_development_level = {
								subtract = scope:county.development_level
								multiply = 0.5
								floor = yes
							}
							every_county_province = {
								limit = {
									has_holding = yes
									num_buildings >= 2
								}
								destroy_random_building_variable_effect = yes
								destroy_random_building_effect = yes
							}
							every_county_province = {
								limit = {
									has_holding = yes
									num_buildings >= 2
								}
								destroy_random_building_variable_effect = yes
								destroy_random_building_effect = yes
							}
							every_county_province = {
								limit = {
									has_holding = yes
									num_buildings >= 2
								}
								destroy_random_building_variable_effect = yes
								destroy_random_building_effect = yes
							}
						}
						
					}
				}
				
				hidden_effect = {
					mpo_gok_civilian_slaughter_totalling_effect = yes
				}
				if = {
					limit = {
						culture = {
							cultural_acceptance = {
								target = scope:attacker.culture
								value > 0
							}
						}
					}
					culture = {
						change_cultural_acceptance = {
							target = scope:attacker.culture
							value = major_cultural_acceptance_loss
							desc = gok_sacking_cultural_acceptance
						}
					}
				}
			}
			if = {
				limit = {
					"list_size(destroyed_holdings)" > 1
				}
				#Holding notification
				save_scope_value_as = {
				 	name = destroyed_holdings
				 	value = "list_size(destroyed_holdings)"
				}
				#Send notification message
				if = {
					limit = {
						scope:defender = {
							trigger_if = {
								limit = {
									highest_held_title_tier >= tier_kingdom
								}
								sub_realm_size >= 2
							}
							trigger_else = {
								highest_held_title_tier >= tier_duchy
								sub_realm_size >= 5
							}
						}
					}
					every_player = {
						limit = {
							OR = {
								in_diplomatic_range = scope:defender
								this = scope:defender
							}
						}
						send_interface_message = {
							type = msg_gok_destruction
							title = gok_destruction.t
							left_icon = scope:gok
							desc = gok_destruction.tooltip
						}
					}
				}
				#Be more discerning with rulers that aren't significant
				else = {
					every_player = {
						limit = {
							OR = {
								this = scope:attacker
								this = scope:defender
								has_any_scripted_relation = scope:defender
								is_close_or_extended_family_of = scope:defender
								is_consort_of = scope:defender
								is_allied_to = scope:defender
							}
						}
						send_interface_message = {
							type = msg_gok_destruction
							title = gok_destruction.t
							left_icon = scope:gok
							desc = gok_destruction.tooltip
						}
					}
				}
			}
			#Slaughter notification
			if = {
				limit = {
					"list_size(gok_slaughter_victims)" > 1
				}
				save_scope_value_as = {
				 	name = gok_slaughter_value
				 	value = "list_size(gok_slaughter_victims)"
				}
				if = {
					limit = {
						scope:defender = {
							trigger_if = {
								limit = {
									highest_held_title_tier >= tier_kingdom
								}
								sub_realm_size >= 2
							}
							trigger_else = {
								highest_held_title_tier >= tier_duchy
								sub_realm_size >= 5
							}
						}
					}
					every_player = {
						limit = {
							OR = {
								this = scope:attacker
								this = scope:defender
								in_diplomatic_range = scope:defender
								has_any_scripted_relation = scope:defender
								is_close_or_extended_family_of = scope:defender
								is_consort_of = scope:defender
								is_allied_to = scope:defender
							}
						}
						send_interface_message = {
							type = msg_gok_slaughter
							title = gok_slaughter.t
							left_icon = scope:gok
							desc = gok_slaughter.tooltip
						}
					}
					every_player = {
						every_in_list = {
							list = gok_slaughter_victims
							limit = {
								OR = {
									has_any_scripted_relation = prev
									is_close_or_extended_family_of = prev
									is_consort_of = prev
									is_allied_to = prev
								}
							}
							save_scope_as = victim
							prev = {
								send_interface_message = {
									type = msg_gok_slaughter
									title = gok_slaughter_victim.t
									left_icon = scope:victim
									desc = gok_slaughter_victim.tooltip
								}
							}
						}
					}
				}
				else = {
					every_player = {
						limit = {
							OR = {
								this = scope:attacker
								this = scope:defender
								has_any_scripted_relation = scope:defender
								is_close_or_extended_family_of = scope:defender
								is_consort_of = scope:defender
								is_allied_to = scope:defender
							}
						}
						send_interface_message = {
							type = msg_gok_slaughter
							title = gok_slaughter.t
							left_icon = scope:gok
							desc = gok_slaughter.tooltip
						}
					}
					every_player = {
						every_in_list = {
							list = gok_slaughter_victims
							limit = {
								OR = {
									has_any_scripted_relation = prev
									is_close_or_extended_family_of = prev
									is_consort_of = prev
									is_allied_to = prev
								}
							}
							save_scope_as = victim
							prev = {
								send_interface_message = {
									type = msg_gok_slaughter
									title = gok_slaughter_victim.t
									left_icon = scope:victim
									desc = gok_slaughter_victim.tooltip
								}
							}
						}
					}
				}
			}
			hidden_effect = {
				every_in_list = {
					list = gok_slaughter_victims
					death = {
						death_reason = death_gok_slaughter
					}
				}
			}
		}
	}
	else = {
		every_sub_realm_county = {
			custom = custom.every_taken_county
			change_county_control = medium_county_control_loss
			change_development_level = {
				subtract = development_level
				multiply = 0.1
				floor = yes
			}
		}
	}
}

mpo_gok_civilian_slaughter_totalling_effect = {
	every_in_list = {
		list = devastation_area
		if = {
			limit = {
				this = holder.capital_county
			}
			holder = {
				if = {
					limit = {
						NOR = {
							this = scope:defender
							is_ai = no
						}
					}
					add_to_list = potential_victims
				}
				every_courtier_or_guest = {
					add_to_list = potential_victims
				}
			}
			#Local pool characters
			every_pool_character = {
				province = prev.holder.capital_province
				add_to_list = potential_victims
			}
		}
	}
	scope:defender = {
		#ai landless house heads in the capital
		every_vassal = {
			limit = {
				is_ai = yes
				is_landless_administrative = yes
				domicile ?= {
					domicile_location.county = {
						this = scope:defender.capital_county
					}
				}
			}
			add_to_list = potential_victims
		}
		#Courtiers of landless house heads in the capital
		every_vassal = {
			limit = {
				is_landless_administrative = yes
				domicile ?= {
					domicile_location.county = {
						this = scope:defender.capital_county
					}
				}
			}
			every_courtier_or_guest = {
				add_to_list = potential_victims
			}
		}
	}
	ordered_in_list = {
		order_by = {
			value = 1
			#I suppose they would probably try to avoid killing their own
			if = {
				limit = {
					NOT = {
						faith = scope:attacker.faith
					}
				}
				add = 1
			}
			if = {
				limit = {
					NOT = {
						culture = scope:attacker.culture
					}
				}
				add = 1
			}
		}
		list = potential_victims
		max = {
			value = "list_size(potential_victims)"
			divide = 2
		}
		add_to_list = gok_slaughter_victims
	}
}

gok_retribution_cleanup_effect = {
	if = {	
		limit = {
			exists = scope:khans_retribution_target
		}
		scope:defender = {
			every_held_title = {
				limit = {
					has_variable = refused_submission
				}
				remove_variable = refused_submission
			}
			every_vassal_or_below = {
				limit = {
					any_held_title = {
						has_variable = refused_submission
					}
				}
				remove_variable = refused_submission
			}
		}
	}
}

gok_world_conquest_generic_rewards_effect = {
	#EK DISABLED
	#custom_tooltip = gok_de_jure_kingdom_gain_tt
	#de jure shift completely controlled kingdoms
	if = {
		limit = {
			is_ai = no
		}
		hidden_effect = {
			every_realm_de_jure_kingdom = {
				limit = {
					NOT = {
						empire = root.primary_title
					}
					any_de_jure_county = {
						count = all
						holder.top_liege = root
					}
				}
				set_de_jure_liege_title = root.primary_title
			}
		}
	}
	#AI aren't smart enough to mop up every single title
	else = {
		hidden_effect = {
			every_realm_de_jure_kingdom = {
				limit = {
					NOT = {
						empire = root.primary_title
					}
					any_de_jure_county = {
						percent >= 0.90
						holder.top_liege = root
					}
					NOT = {
						any_de_jure_county = {
							holder = {
								NOT = {
									any_liege_or_above = {
										this = root 
									}
								}
								is_ai = no
							}
						}
					}
				}
				set_de_jure_liege_title = root.primary_title
			}
		}
	}
	
	
	if = {
		limit = {
			exists = dynasty
		}
		dynasty = {
			add_dynasty_prestige = monumental_dynasty_prestige_gain
		}
	}

	if = {
		limit = {
			has_education_martial_trigger = yes
			NOT = {
				has_trait = education_martial_5
			}
		}
		remove_trait = education_martial_1
		remove_trait = education_martial_2
		remove_trait = education_martial_3
		remove_trait = education_martial_4
		custom_tooltip = {
			text = gain_5th_lvl_education_martial_tt
			add_trait = education_martial_5
		}
		
	}
	else_if = {
		limit = {
			has_education_diplomacy_trigger = yes
			NOT = {
				has_trait = education_diplomacy_5
			}
		}
		remove_trait = education_diplomacy_1
		remove_trait = education_diplomacy_2
		remove_trait = education_diplomacy_3
		remove_trait = education_diplomacy_4
		custom_tooltip = {
			text = gain_5th_lvl_education_diplomacy_tt
			add_trait = education_diplomacy_5
		}
	}
	else_if = {
		limit = {
			has_education_stewardship_trigger = yes
			NOT = {
				has_trait = education_stewardship_5
			}
		}
		remove_trait = education_stewardship_1
		remove_trait = education_stewardship_2
		remove_trait = education_stewardship_3
		remove_trait = education_stewardship_4
		custom_tooltip = {
			text = gain_5th_lvl_education_stewardship_tt
			add_trait = education_stewardship_5
		}
	}
	else_if = {
		limit = {
			has_education_intrigue_trigger = yes
			NOT = {
				has_trait = education_intrigue_5
			}
		}
		remove_trait = education_intrigue_1
		remove_trait = education_intrigue_2
		remove_trait = education_intrigue_3
		remove_trait = education_intrigue_4
		custom_tooltip = {
			text = gain_5th_lvl_education_intrigue_tt
			add_trait = education_intrigue_5
		}
	}
	else_if = {
		limit = {
			has_education_learning_trigger = yes
			NOT = {
				has_trait = education_learning_5
			}
		}
		remove_trait = education_learning_1
		remove_trait = education_learning_2
		remove_trait = education_learning_3
		remove_trait = education_learning_4
		custom_tooltip = {
			text = gain_5th_lvl_education_learning_tt
			add_trait = education_learning_5
		}
	}
	else = {
		add_trait = shrewd
	}
}

gok_upgrade_realm_and_government_effect = {
	if = {
		limit = {
			exists = scope:realm_culture_1
		}
		culture = {
			get_random_innovation_from = scope:realm_culture_1
		}
	}
	if = {
		limit = {
			exists = scope:realm_culture_2
		}
		culture = {
			get_random_innovation_from = scope:realm_culture_2
		}
	}
	if = {
		limit = {
			exists = scope:realm_culture_3
		}
		culture = {
			get_random_innovation_from = scope:realm_culture_3
		}
	}

	capital_county = {
		if = {
			limit = {
				any_county_province = {
					OR = {
						has_holding_type = nomad_holding
						has_holding_type = herder_holding
					}
				}
			}
			add_county_modifier = {
				modifier = great_khans_capital_modifier
				years = 30
			}
		}
		custom_tooltip = gok_capital_holdings_switch_tt

		hidden_effect = {
			every_county_province = {
				limit = {
					has_holding = yes
					OR = {
						has_holding_type = nomad_holding
						has_holding_type = herder_holding
					}
				}
				set_holding_type = castle_holding
				add_building = castle_02
				if = {
					limit = {
						any_culture_global = {
							has_cultural_era_or_later = culture_era_high_medieval
						}
					}
					add_building = castle_03
				}
				if = {
					limit = {
						any_culture_global = {
							has_cultural_era_or_later = culture_era_late_medieval
						}
					}
					add_building = castle_04
				}
			}
			random_county_province = {
				limit = {
					has_holding = no
				}
				save_scope_as = capital_prov_1
				set_holding_type = church_holding

				if = {
					limit = {
						any_culture_global = {
							has_cultural_era_or_later = culture_era_high_medieval
						}
					}
					add_building = temple_03
				}
				if = {
					limit = {
						any_culture_global = {
							has_cultural_era_or_later = culture_era_late_medieval
						}
					}
					add_building = temple_02
				}
			}
			random_county_province = {
				limit = {
					exists = scope:capital_prov_1
					has_holding = no
					NOT = {
						this = scope:capital_prov_1
					}
				}
				set_holding_type = city_holding

				if = {
					limit = {
						any_culture_global = {
							has_cultural_era_or_later = culture_era_high_medieval
						}
					}
					add_building = city_03
				}
				if = {
					limit = {
						any_culture_global = {
							has_cultural_era_or_later = culture_era_late_medieval
						}
					}
					add_building = city_02
				}
			}
		}
	}
	custom_tooltip = gok_every_held_title_gains_castles
	custom_tooltip = gok_some_nomad_vassals_holdings_switch
	hidden_effect = {
		every_held_title = {
			limit = {
				tier = tier_county
				any_county_province = {
					is_county_capital = yes
					OR = {
						has_holding_type = nomad_holding
						has_holding_type = herder_holding
					}
				}
			}
			every_county_province = {
				limit = {
					is_county_capital = yes
					OR = {
						has_holding_type = nomad_holding
						has_holding_type = herder_holding
					}
				}
				set_holding_type = castle_holding
			}
		}
		every_realm_county = {
			limit = {
				any_county_province = {
					is_county_capital = yes
					OR = {
						has_holding_type = nomad_holding
						has_holding_type = herder_holding
					}
				}
				holder = {
					is_in_list = switching_vassals
				}
			}
			every_county_province = {
				limit = {
					is_county_capital = yes
					OR = {
						has_holding_type = nomad_holding
						has_holding_type = herder_holding
					}
				}
				set_holding_type = castle_holding
				#holder is a high lord, upgrade their castle a bit
				if = {
					limit = {
						county.holder = {
							highest_held_title_tier >= tier_duchy
						}
						this = county.holder.capital_province
					}
					if = {
						limit = {
							any_culture_global = {
								has_cultural_era_or_later = culture_era_high_medieval
							}
						}
						add_building = castle_02
					}
					if = {
						limit = {
							any_culture_global = {
								has_cultural_era_or_later = culture_era_late_medieval
							}
						}
						add_building = castle_03
					}
				}
			}
			#Holder is a king, give capital some extra holdings
			if = {
				limit = {
					holder = {
						highest_held_title_tier >= tier_kingdom
					}
					this = holder.capital_county
				}
				random_county_province = {
					limit = {
						has_holding = no
					}
					save_scope_as = capital_prov_1
					begin_create_holding = church_holding
				}
				random_county_province = {
					limit = {
						exists = scope:capital_prov_1
						has_holding = no
						NOT = {
							this = scope:capital_prov_1
						}
					}
					begin_create_holding = city_holding
				}
			}
		}
	}
}

gok_final_decision_list_setup = {
	#Switching vassals to feudalism or clan
	every_vassal_or_below = {
		limit = {
			gok_gov_switch_valid_vassal_trigger = yes
			mpo_greatest_of_khans_0030_willing_nomad_vassal = yes
		}
		add_to_list = switching_vassals
	}
	save_scope_value_as = {	
		name = switching_vassals_value
		value = "list_size(switching_vassals)"
	}
	#Switching vassals TO nomadism
	every_vassal_or_below = {
		limit = {
			NOR = {
				government_has_flag = government_is_nomadic
				government_has_flag = government_is_herder
			}
			gok_gov_switch_valid_vassal_trigger = yes
		}
		#ones willing to switch can remain in power
		if = {
			limit = {
				OR = {
					has_trait = nomadic_philosophy
					culture = {
						has_cultural_tradition = tradition_horse_lords
					}
					culture = {
						has_cultural_tradition = tradition_devoted_horsemanship
					}
					AND = {
						highest_held_title_tier >= tier_kingdom
						mpo_greatest_of_khans_0030_dominated_sedentary_vassal = yes
					}
					AND = {
						highest_held_title_tier >= tier_duchy
						mpo_greatest_of_khans_0030_willing_sedentary_vassal = yes
					}
					highest_held_title_tier = tier_county
				}
			}
			add_to_list = sedentary_to_nomad_vassals
		}
		#The others must go
		else = {
			add_to_list = city_state_vassals
		}
	}
	save_scope_value_as = {	
		name = sedentary_to_nomad_vassals_value
		value = "list_size(sedentary_to_nomad_vassals)"
	}
	save_scope_value_as = {	
		name = city_state_vassals_value
		value = "list_size(city_state_vassals)"
	}
	#counties that will be switched from non-nomadic to nomadic
	every_realm_county = {
		limit = {
			NOR = {
				#Already nomadic
				any_county_province = {
					OR = {
						has_holding_type = nomad_holding
						has_holding_type = herder_holding
					}
				}
				#Holder is invalid for switching
				holder = { gok_gov_switch_valid_vassal_trigger = no }
				#De jure kingdom capital (probably important)
				this = kingdom.title_capital_county
				AND = {
					holder = {
						is_in_list = city_state_vassals
					}
					this = holder.capital_county
				}
			}
		}
		add_to_list = burned_to_nomadism
	}
	save_scope_value_as = {	
		name = burned_to_nomadism_value
		value = "list_size(burned_to_nomadism)"
	}
}

#EK DISABLED: not used by us
### GoK will automatically declare DEVASTATING wars
#gok_war_target_evaluation_and_declaration_effect

mpo_add_golden_lineage_effect = {
	add_trait = golden_lineage
	if = {
		limit = {
			exists = dynasty
		}
		custom_tooltip = descendants_gain_golden_lineage
		hidden_effect = {
			dynasty = {
				every_dynasty_member = {
					custom = custom
					limit = {
						any_ancestor = {
							this = $CHARACTER$
						}
					}
					add_trait = golden_lineage
				}
			}
		}
	}
	every_child = {
		limit = {
			OR = {
				has_trait = bastard
				has_trait = legitimized_bastard
			}
			NOT = {
				has_trait = golden_lineage
			}
		}
		add_trait = golden_lineage
		if = {
			limit = {
				is_male = yes
			}
			every_child = {
				add_trait = golden_lineage
			}
		}
	}
}
