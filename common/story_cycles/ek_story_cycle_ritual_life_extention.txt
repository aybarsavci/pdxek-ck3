story_cycle_ritual_life_extension_ = {

	on_setup = {
		set_variable = { name = grand_ritual value = flag:life_extension_ } #used to identify? random_owned_story = { limit = { exists = var:grand_ritual exists = PREV.var:grand_ritual var:grand_ritual = PREV.var:grand_ritual } }

		set_variable = { name = stage value = 1 }
		story_owner = {
			set_variable = { name = grand_ritual_story value = PREV }
			trigger_event = { id = grand_ritual.1000 days = { 2 4 } }
		}

		# story_owner = {
		# 	#stages in order in list. check list size for end trigger
		# 	add_to_variable_list = { name = stages target = flag:stage_1 }
		# 	add_to_variable_list = { name = stages target = flag:stage_2 }
		# 	add_to_variable_list = { name = stages target = flag:stage_3 }
		# 	add_to_variable_list = { name = stages target = flag:stage_4 }
		# 	add_to_variable_list = { name = stages target = flag:stage_5 }
		# 	#list of completed changes. active stage var
		# 	set_variable = { name = stage_active value = flag:stage_1 }
		# 	set_variable = { name = grand_ritual value = flag:life_extension_ }
		# 	#cost from script value accessing story variable, or hard coded in script value
		# 	#time remaining also from script value? cant get variable time remaining through that though so only year accurate estimates
		# 	set_variable = { name = grand_ritual_complete value = yes days = life_extension_time } #can fold into name variable
		# }
		#story_owner = {
		# set_variable = { name = grand_ritual value = scope:story } #you can apparently not hold a story in a variable SCOPE_DEBUG_STORY. dont know if should be able to as they arent persistent, flags from the console can give the same effect
		#so since the original plan wont work we go with plan b and have the story cycle drive player vars rather than using it directly. probably have generc ritual cycle with flag for type and num stages
		#}

		#initial success chance set based on lifespan tier level. decrease in risk between 3->4/4->5/5->6 of 27.5 to 15 at 6->7 ok. life expectancy +1000 is functionally immortality, +character should have learned from past
		# use logistical decay for initial chances - (100/(1+e^-x)) gives percentage chance. assume 0 for 4->5
		# 0->1 - 100 - 2.5	= 97.5%		|	95   symetric maybe better
		# 1->2 - 100 - 5	= 95%		|	87.5
		# 2->3 - 100 - 12.5 = 87.5%		|	72.5
		# 3->4 - 100 - 27.5 = 72.5%		\	50
		# 4->5 - 100 - 50 	= 50%		|	27.5
		# 5->6 - 100 - 72.5	= 27.5%		|	12.5
		# 6->7 - 100 - 87.5 = 12.5%		|	5
		# cumulative chance for human: 1.01% (lifespan 0 assumed)
		# cumulative chance for mer: 1.25% (lifespan 3 assumed)
		# base chances ^. skill, choices, preparation(take time, be careful), etc should massively improve chances.
		# above chances should be pmuch if someone managed to achieve immortality 'accidentally' or by fluke
		# system similar ek1 with seed? have some threshold value that must be exceeded to succeed. averages to above chances

		# event widgets showing progress for ritual

		# (float a, float b, int c)		time_remaining, time, 365
		# (a/b)*c

		#can use random = { chance = scope:story.var:success_chance } if dont care about reload.
		#alternatively have success_chance be a 'score'. need to reach threshold (Th) for success - 1.5Th = complet, no side effects. 1.0Th = complete, side effects. 0.9Th = fail, no side effects. 0.5Th = fail, side effects. 0.0Th = fail, death/incapable


		#success_chance - modified by events
		#success_base - initial chance depending on level of lifespan
		# random_list = {
		# 	1 = { #success - failure goes to zero when succ >= 100
		# 		modifier = { multiply = scope:story.var:success_chance }
		# 		random_list = {
		# 			1 = { #no side effects - failure goes to zero when succ >= 150
		# 				modifier = { multiply = { value = scope:story.var:success_chance subtract = 50 } }
		# 			}
		# 			1 = { #side effects
		# 				#modifier = { multiply = { value = 100 subtract = { value = scope:story.var:success_chance subtract = 50 } min = 0 }
		# 				modifier = { multiply = { value = 150 subtract = scope:story.var:success_chance min = 0 }
		# 			}
		# 		}
		# 	}
		# 	1 = { #failure
		# 		modifier = { multiply = { value = 100 subtract = scope:story.var:success_chance min = 0 }
		# 		random_list = {
		# 			1 = { #side effects
		# 				modifier = { multiply = { value = scope:story.var:success_chance add = 50 } }
		# 			}
		# 			1 = { #severe effects
		# 				#modifier = { multiply = { value = 100 subtract = { value = scope:story.var:success_chance add = 50 } min = 0 }
		# 				modifier = { multiply = { value = 50 subtract = scope:story.var:success_chance min = 0 }
		# 			}
		# 		}
		# 	}
		# }

		# seed value, max = seed+50 min = seed-50
		# failure_severe
		# failure_moderate	40 if(seed_max<=40, subtract = (40-seed_max)) if(seed_min>0, subtract = seed_min)
		# failure_no			10 if(seed_max<=50, subtract = (50-seed_max)) if(seed_min>40, subtract = (seed_min-40))
		# success_moderate	50 if(seed_max<=100, subtract = (100-seed_max)) if(seed_min>50, subtract = (seed_min-50))
		# success_total

		#store stages in ritual? use script values for completion.
		#test if can access through variable
		#stages name = sript value for gui comparison. remove need for complete list

		story_owner = { #can move seed to story
			if = {
				limit = { has_trait_rank = { trait = lifespan rank = 1 } }
				PREV = { set_variable = { name = seed value = 87.5 } }
			}
			else_if = {
				limit = { has_trait_rank = { trait = lifespan rank = 2 } }
				PREV = { set_variable = { name = seed value = 72.5 } }
			}
			else_if = {
				limit = { has_trait_rank = { trait = lifespan rank = 3 } }
				PREV = { set_variable = { name = seed value = 50 } }
			}
			else_if = {
				limit = { has_trait_rank = { trait = lifespan rank = 4 } }
				PREV = { set_variable = { name = seed value = 27.5 } }
			}
			else_if = {
				limit = { has_trait_rank = { trait = lifespan rank = 5 } }
				PREV = { set_variable = { name = seed value = 12.5 } }
			}
			else_if = {
				limit = { has_trait_rank = { trait = lifespan rank = 6 } }
				PREV = { set_variable = { name = seed value = 5 } }
			}
			else = {
				PREV = { set_variable = { name = seed value = 95 } }
			}
		}
	}

	on_end = { #dont end story until immortal. keep and use to store stuff. active/inactive state for doing other g ritualss
		if = {
			limit = {
				exists = var:stage
				var:stage = life_extension_stages
				exists = var:seed
				story_owner = { is_alive = yes }
			}
			random_list = {
				1 = {
					modifier = { factor = var:seed.fail_tot }
					story_owner = { trigger_event = grand_ritual.1901 }
				}
				1 = {
					modifier = { factor = var:seed.fail_mod }
					story_owner = { trigger_event = grand_ritual.1902 }
				}
				1 = {
					modifier = { factor = var:seed.fail_no }
					story_owner = { trigger_event = grand_ritual.1903 }
				}
				1 = {
					modifier = { factor = var:seed.succ_mod }
					story_owner = { trigger_event = grand_ritual.1904 }
				}
				1 = {
					modifier = { factor = var:seed.succ_tot }
					story_owner = { trigger_event = grand_ritual.1905 }
				}
			}
		}
		else_if = { #something wrong if no seed
			limit = { NOT = { exists = var:seed } }
			debug_log = "Life Extension Grand Ritual ended on:"
			debug_log_date = yes
			debug_log = "But there was no seed!"
			debug_log_scopes = yes
		}
		else = { #ritual ended by event choice. v2 will not end story, will need to handle

		}
		story_owner = {
			#remove_variable = stage_active
			remove_variable = grand_ritual_complete
			remove_variable = grand_ritual
			remove_variable = grand_ritual_story
			#clear_variable_list = stages
			#clear_variable_list = stages_complete
		}
	}

	on_owner_death = {
		scope:story = { end_story = yes }
	}

	# effect_group = {
	# 	days = 365
	# 	#days = 5

	# 	trigger = {
	# 		exists = var:stage_active
	# 	}

	# 	first_valid = {
	# 		triggered_effect = {
	# 			trigger = { var:stage_active = 1 }
	# 			effect = {
	# 				set_variable = { name = stage_active value = 2 }
	# 				clear_variable_list = done_events
	# 			}
	# 		}
	# 		triggered_effect = {
	# 			trigger = { var:stage_active = 2 }
	# 			effect = {
	# 				set_variable = { name = stage_active value = 3 }
	# 				clear_variable_list = done_events
	# 			}
	# 		}
	# 		triggered_effect = {
	# 			trigger = { var:stage_active = 3 }
	# 			effect = {
	# 				set_variable = { name = stage_active value = 4 }
	# 				clear_variable_list = done_events
	# 			}
	# 		}
	# 		triggered_effect = {
	# 			trigger = { var:stage_active = 4 }
	# 			effect = {
	# 				set_variable = { name = stage_active value = 5 }
	# 				clear_variable_list = done_events
	# 			}
	# 		}
	# 		triggered_effect = {
	# 			trigger = { var:stage_active = 5 }
	# 			effect = {
	# 				scope:story = { end_story = yes }
	# 			}
	# 		}
	# 	}
	# }

	# # Something happens - random events
	# effect_group = {
	# 	days = { 70 120 } # ~1/5 to 1/3 stage time ie get 3-5 events per stage
	# 	#chance = 50

	# 	trigger = {
	# 		exists = var:stage_active
	# 	}

	# 	first_valid = {
	# 		triggered_effect = {
	# 			trigger = { var:stage_active = 1 } #research
	# 			effect = {
	# 				random_list = {
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1101 } } }
	# 						add_to_variable_list = { name = done_events target = 1101 }
	# 						story_owner = { trigger_event = grand_ritual.1110 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1102 } } }
	# 						add_to_variable_list = { name = done_events target = 1102 }
	# 						story_owner = { trigger_event = grand_ritual.1120 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1103 } } }
	# 						add_to_variable_list = { name = done_events target = 1103 }
	# 						story_owner = { trigger_event = grand_ritual.1130 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1104 } } }
	# 						add_to_variable_list = { name = done_events target = 1104 }
	# 						story_owner = { trigger_event = grand_ritual.1140 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1105 } } }
	# 						add_to_variable_list = { name = done_events target = 1105 }
	# 						story_owner = { trigger_event = grand_ritual.1150 }
	# 					}
	# 					1 = { trigger = { exists = var:done_events variable_list_size = { name = done_events value >= 5 } } } #do nothing. incase all events have fired
	# 				}
	# 			}
	# 		}
	# 		triggered_effect = {
	# 			trigger = { var:stage_active = 2 } #experimentation
	# 			effect = {
	# 				random_list = {
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1201 } } }
	# 						add_to_variable_list = { name = done_events target = 1201 }
	# 						story_owner = { trigger_event = grand_ritual.1210 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1202 } } }
	# 						add_to_variable_list = { name = done_events target = 1202 }
	# 						story_owner = { trigger_event = grand_ritual.1220 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1203 } } }
	# 						add_to_variable_list = { name = done_events target = 1203 }
	# 						story_owner = { trigger_event = grand_ritual.1230 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1204 } } }
	# 						add_to_variable_list = { name = done_events target = 1204 }
	# 						story_owner = { trigger_event = grand_ritual.1240 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1205 } } }
	# 						add_to_variable_list = { name = done_events target = 1205 }
	# 						story_owner = { trigger_event = grand_ritual.1250 }
	# 					}
	# 					1 = { trigger = { exists = var:done_events variable_list_size = { name = done_events value >= 5 } } } #do nothing. incase all events have fired
	# 				}
	# 			}
	# 		}
	# 		triggered_effect = {
	# 			trigger = { var:stage_active = 3 } #material aquisition
	# 			effect = {
	# 				random_list = {
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1301 } } }
	# 						add_to_variable_list = { name = done_events target = 1301 }
	# 						story_owner = { trigger_event = grand_ritual.1310 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1302 } } }
	# 						add_to_variable_list = { name = done_events target = 1302 }
	# 						story_owner = { trigger_event = grand_ritual.1320 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1303 } } }
	# 						add_to_variable_list = { name = done_events target = 1303 }
	# 						story_owner = { trigger_event = grand_ritual.1330 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1304 } } }
	# 						add_to_variable_list = { name = done_events target = 1304 }
	# 						story_owner = { trigger_event = grand_ritual.1340 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1305 } } }
	# 						add_to_variable_list = { name = done_events target = 1305 }
	# 						story_owner = { trigger_event = grand_ritual.1350 }
	# 					}
	# 					1 = { trigger = { exists = var:done_events variable_list_size = { name = done_events value >= 5 } } } #do nothing. incase all events have fired
	# 				}
	# 			}
	# 		}
	# 		triggered_effect = {
	# 			trigger = { var:stage_active = 4 } #final prep
	# 			effect = {
	# 				random_list = {
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1401 } } }
	# 						add_to_variable_list = { name = done_events target = 1401 }
	# 						story_owner = { trigger_event = grand_ritual.1410 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1402 } } }
	# 						add_to_variable_list = { name = done_events target = 1402 }
	# 						story_owner = { trigger_event = grand_ritual.1420 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1403 } } }
	# 						add_to_variable_list = { name = done_events target = 1403 }
	# 						story_owner = { trigger_event = grand_ritual.1430 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1404 } } }
	# 						add_to_variable_list = { name = done_events target = 1404 }
	# 						story_owner = { trigger_event = grand_ritual.1440 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1405 } } }
	# 						add_to_variable_list = { name = done_events target = 1405 }
	# 						story_owner = { trigger_event = grand_ritual.1450 }
	# 					}
	# 					1 = { trigger = { exists = var:done_events variable_list_size = { name = done_events value >= 5 } } } #do nothing. incase all events have fired
	# 				}
	# 			}
	# 		}
	# 		triggered_effect = {
	# 			trigger = { var:stage_active = 5 } #execution
	# 			effect = {
	# 				random_list = {
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1501 } } }
	# 						add_to_variable_list = { name = done_events target = 1501 }
	# 						story_owner = { trigger_event = grand_ritual.1510 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1502 } } }
	# 						add_to_variable_list = { name = done_events target = 1502 }
	# 						story_owner = { trigger_event = grand_ritual.1520 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1503 } } }
	# 						add_to_variable_list = { name = done_events target = 1503 }
	# 						story_owner = { trigger_event = grand_ritual.1530 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1504 } } }
	# 						add_to_variable_list = { name = done_events target = 1504 }
	# 						story_owner = { trigger_event = grand_ritual.1540 }
	# 					}
	# 					10 = {
	# 						trigger = { NOT = { is_target_in_variable_list = { name = done_events target = 1505 } } }
	# 						add_to_variable_list = { name = done_events target = 1505 }
	# 						story_owner = { trigger_event = grand_ritual.1550 }
	# 					}
	# 					1 = { trigger = { exists = var:done_events variable_list_size = { name = done_events value >= 5 } } } #do nothing. incase all events have fired
	# 				}
	# 			}
	# 		}
	# 	}
	# }
}