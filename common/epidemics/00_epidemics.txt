@default_tile_multiplier = 0.009702

smallpox = {
	trait = smallpox
	color = { 88 12 31 }
	priority = 3

	shader_data = {
		strength = 0.8
		edge_fade = 0.25
		tile_multiplier = 0.004702
		texture_index = 0
		channel = alpha
	}

	name = {
		first_valid = {
			#EK DISABLED EPIDEMICS: deleted some rl references/easter eggs
			random_valid = {
				#EK DISABLED EPIDEMICS: rl references
				#triggered_desc = {
				#	trigger = {
				#		outbreak_intensity = apocalyptic
				#		outbreak_province = {
				#			geographical_region = ghw_region_egypt
				#			county.faith.religion = { is_in_family = rf_abrahamic }
				#		}
				#	}
				#	desc = epidemic_eleventh_plague
				#}
				desc = epidemic_rulers_pox
				desc = epidemic_titled_rulers_pox
				desc = epidemic_animal_pox # Monkeypox, chickenpox and the like
				desc = epidemic_realm_pox
				desc = epidemic_holder_pox
				desc = epidemic_culture_pox
				desc = epidemic_location_pox
			}
			desc = trait_smallpox
		}
	}
	
	on_start = {
		# LEGITIMACY LOSS FROM EPIDEMIC OUTBREAK
		epidemic_outbreak_legitimacy_effect = { PROVINCE = root.outbreak_province }
	}

	on_monthly = {
		trigger_event = {
			on_action = epidemic_ongoing_events
		}
	}

	character_infection_chance = {
		value = character_infection_chance_default_value
	}

	can_infect_character = {
		can_contract_disease_trigger = { DISEASE = smallpox }
		immune_to_epidemic = { EPIDEMIC = scope:epidemic }
	}

	on_character_infected = {
		contract_disease_notify_effect = { DISEASE = smallpox }
		if = {
			limit = {
				is_commanding_army = yes
			}
			trigger_event = epidemic_events.0001 #we infect your army
		}
	}

	infection_levels = {
		10 = {
			province_modifier = {
				county_opinion_add = -2
				epidemic_travel_danger = 10
				development_decline = -1
			}	
		}
		50 = {
			province_modifier = {
				county_opinion_add = -3
				epidemic_travel_danger = 20
				development_decline = -2
			}	
		}
		80 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.1
				supply_limit_mult = -0.2
				county_opinion_add = -5
				epidemic_travel_danger = 30
				development_decline = -3
			}
		}
	}

	outbreak_intensities = {
		minor = {
			outbreak_chance = {
				value = outbreak_chance_minor_default_value
				multiply = outbreak_chance_minor_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				
				### NO DLC - We increase the chance to make up for the locked diseases ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					multiply = 2
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 15 30 }

			infection_duration = {
				months = { 6 8 }
			}

			infection_progress_duration = {
				days = { 80 120 }
			}

			infection_recovery_duration = {
				days = { 15 22 }
			}
		}

		major = {
			outbreak_chance = {
				value = outbreak_chance_major_default_value
				multiply = outbreak_chance_major_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				
				### NO DLC - We increase the chance to make up for the locked diseases ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					multiply = 1.5
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 45 70 }

			infection_duration = {
				months = { 10 20 }
			}

			infection_progress_duration = {
				days = { 40 60 }
			}

			infection_recovery_duration = {
				days = 25
			}
		}

		apocalyptic = {
			outbreak_chance = {
				value = outbreak_chance_apocalyptic_default_value
				multiply = outbreak_chance_apocalyptic_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				
				### NO DLC - We increase the chance to make up for the locked diseases ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					multiply = 1.25
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 120 180 }

			infection_duration = {
				months = { 22 40 }
			}
			
			infection_progress_duration = {
				days = { 15 20 }
			}

			infection_recovery_duration = {
				days = { 25 35 }
			}
		}
	}
	
	on_province_infected = {
		county = {
			apply_infection_development_loss = { BASE = 5 }
		}
		cant_touch_this_achievement_effect = yes
		ek_on_province_infected_peryite_corruption_add = yes # EK ADDITION: chance of peryite corruption
	}
	
	on_province_recovered = {
		county = {
			remove_isolated_capital_modifiers_effect = yes
			ek_lift_quarantine_for_recovered = yes #EK EDIT: Vanilla kinda forgot to lift quarantines once a province recovered
		}
		add_to_variable_list = {
			name = epidemic_cooldown
			target = scope:epidemic.epidemic_type
			years = 50
		}
		set_variable = {
			name = epidemic_cooldown_general
			years = 15
		}
		# Prosperity event
		plague_recovery_event_effect = yes
	}
}

bubonic_plague = {
	trait = bubonic_plague
	color = { 30 0 0 } #EK EDIT EPIDEMICS: darker red for the crimson plague!
	priority = 5

	shader_data = {
		strength = 0.8
		edge_fade = 0.4
		tile_multiplier = 0.005
		texture_index = 0
		channel = red
	}

	name = {
		first_valid = {
			#EK DISABLED EPIDEMICS: deleted some rl references/easter eggs
			triggered_desc = {
				trigger = {
					outbreak_intensity = apocalyptic
				}
				desc = epidemic_black_death
			}
			#EK ADDITION: alternative lore name, used for non-main event
			triggered_desc = {
				trigger = {
					outbreak_intensity = major
				}
				desc = epidemic_crimson_plague
			}
			#EK DISABLED EPIDEMICS: rl references
			triggered_desc = {
				trigger = {
					outbreak_intensity = major
				}
				desc = epidemic_reapers_will
			}
			triggered_desc = {
				trigger = {
					outbreak_intensity = major
				}
				desc = epidemic_reapers_due
			}
			triggered_desc = {
				trigger = {
					outbreak_intensity = major
				}
				desc = epidemic_wicked_blight
			}
			random_valid = {
				desc = epidemic_realm_plague
				desc = epidemic_culture_plague
				desc = epidemic_location_plague
				desc = epidemic_ruler_plague
				desc = epidemic_titled_ruler_plague
				desc = epidemic_evil_god_plague
				#desc = epidemic_bubonic_plague #EK DISABLED
			}
		}
	}
	
	on_start = {
		if = {
			limit = {
				outbreak_intensity = apocalyptic
			}

			set_global_variable = black_death_happened

			set_global_variable = {
				name = black_death
				value = root
			}
		}
		# LEGITIMACY LOSS FROM EPIDEMIC OUTBREAK
		epidemic_outbreak_legitimacy_effect = { PROVINCE = root.outbreak_province }
	}

	on_end = {
		if = {
			limit = {
				outbreak_intensity = apocalyptic
			}
			remove_global_variable = black_death
		}
	}
	
	on_monthly = {
		trigger_event = {
			on_action = epidemic_ongoing_events
		}
		#EK ADDITION: to handle knahaten specific events
		#EK TODO KNAHATEN: we might wanna transform this into a proper story cycle. we can't use the black death one as it is locked behind the dlc
		if = {
			limit = { #those should only trigger during the main event
				scope:epidemic = { outbreak_intensity = apocalyptic }
			} 
			if = {
				limit = {
					any_sub_realm_county = {
						title_province = { geographical_region = mundus_tamriel_elsweyr }
					}
				}
				trigger_event = {
					on_action = ek_knahaten_elsweyr_events
				}
			}
			if = {
				limit = {
					any_sub_realm_county = {
						title_province = { geographical_region = mundus_tamriel_black_marsh }
					}
				}
				trigger_event = {
					on_action = ek_knahaten_black_marsh_events
				}
			}
			if = {
				limit = {
					any_sub_realm_county = {
						title_province = { geographical_region = mundus_tamriel_hammerfell }
					}
				}
				trigger_event = {
					on_action = ek_knahaten_hammerfell_events
				}
			}
			# Systres isolationism. If a springboard county was infected, the Systres get notified
			if = {
				limit = {
					any_sub_realm_county = {
						title_province = { geographical_region = ek_knahaten_systres_springboard }
					} 
					OR = {
						AND = {
							exists = title:d_systres.holder
							title:d_systres.holder = { has_title = title:c_systres }
						}
						AND = {
							exists = title:k_systres.holder
							title:k_systres.holder = { has_title = title:c_systres }
						}
					}
				}
				if = {
					limit = {
						AND = {
							exists = title:k_systres.holder
							title:k_systres.holder = { has_title = title:c_systres }
						}
					}
					title:k_systres.holder = { trigger_event = { id = ek_knahaten_events_hfl.0001 days = { 30 60 }}}
				}
				else_if = {
					limit = {
						AND = {
							exists = title:d_systres.holder
							title:d_systres.holder = { has_title = title:c_systres }
						}
					}
					title:d_systres.holder = { trigger_event = { id = ek_knahaten_events_hfl.0001 days = { 30 60 }}}
				}
			}
		}
		#EK ADDITION END
	}

	character_infection_chance = {
		value = character_infection_chance_default_value
		multiply = 0.02 #The only way we can make it not kill every single character in the game
	}

	can_infect_character = {
		can_contract_disease_trigger = { DISEASE = bubonic_plague }
		immune_to_epidemic = { EPIDEMIC = scope:epidemic }
	}

	on_character_infected = {
		contract_disease_notify_effect = { DISEASE = bubonic_plague }
	}

	infection_levels = {
		10 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.3 #EK EDIT: was -0.6, ek2 has lower control uptick than vanilla
				development_decline = -1 #EK EDIT: was -3, knahaten hits earlier than plague in vanilla
				levy_reinforcement_rate = -0.3
				levy_size = -0.25
				supply_limit_mult = -0.2
				county_opinion_add = -10
				epidemic_travel_danger = 25
			}	
		}
		50 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.4 #EK EDIT: was -0.8, ek2 has lower control uptick than vanilla
				development_decline = -2 #EK EDIT: was -6, knahaten hits earlier than plague in vanilla
				levy_reinforcement_rate = -0.5
				levy_size = -0.4
				supply_limit_mult = -0.5
				county_opinion_add = -20 #EK EDIT: was -20, Knahaten is around longer than plague
				epidemic_travel_danger = 40
			}	
		}
		80 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.4 #EK EDIT: was -0.8, ek2 has lower control uptick than vanilla
				development_decline = -4 #EK EDIT: was -8, knahaten hits earlier than plague in vanilla
				levy_reinforcement_rate = -0.9 #EK EDIT: was -1, Knahaten is around longer than plague
				levy_size = -0.5
				supply_limit_mult = -1
				county_opinion_add = -25
				epidemic_travel_danger = 60
			}
		}
	}

	outbreak_intensities = {
		minor = {
			outbreak_chance = {
				value = outbreak_chance_minor_default_value
				multiply = outbreak_chance_minor_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				#multiply = 0.0005 #should almost never be minor #EK DISABLED: handled below
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
				#EK ADDITION: if set to historical, it may only reappear in a minor capacity after 603
				if = {
					limit = {
						has_game_rule = bd_occurrence_historical
						current_date > 3525.1.1
					}
					multiply = 0.04
					#Additionally, we know the Knahaten continued to plague Elsweyr for a prolonged period/repeatedly
					if = {
						limit = {
							geographical_region = mundus_tamriel_elsweyr
						}
						multiply = 1.2
					}
				}
				else = {
					multiply = 0.00025 #should almost never be minor
				}
				#EK ADDITION END
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
				divide = 2 #EK EDIT: vanilla map is much larger than EK2, so we need to reduce the speed here.
			}
			max_provinces = { 100 200 }

			infection_duration = {
				months = { 6 12 }
			}

			infection_progress_duration = {
				days = { 50 70 } #EK EDIT: was 40 60
			}

			infection_recovery_duration = {
				days = { 25 35 }
			}
		}

		major = {
			outbreak_chance = {
				value = outbreak_chance_major_default_value
				multiply = outbreak_chance_major_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				multiply = 0.005 #should almost never be major
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
				#EK ADDITION: since it was artificially created, it may not appear before 3480 at all
				if = {
					limit = {
						has_game_rule = bd_occurrence_historical
						current_date < 3480.1.1 #EK EDIT EPIDEMICS: historical start of knahaten
					}
					value = 0
				}
				#nor should it reappear in a major capacity after 603
				if = {
					limit = {
						has_game_rule = bd_occurrence_historical
						current_date > 3525.1.1
					}
					value = 0
				}
				#Additionally, we know the Knahaten continued to plague Elsweyr for a prolonged period/repeatedly
				if = {
					limit = {
						geographical_region = mundus_tamriel_elsweyr
					}
					multiply = 1.2
				}
				#EK ADDITION END
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}

			max_provinces = { 300 500 }

			infection_duration = {
				months = { 12 24 }
			}

			infection_progress_duration = {
				days = { 25 35 }
			}

			infection_recovery_duration = {
				days = { 50 70 }
			}
		}

		apocalyptic = { #The Black Death
			# We trigger the event specially for Black Death
			notification = {
				global = yes
				holder_event = ""
				liege_event = ""
				realm_event = ""
			}
			
			outbreak_chance = {
				value = {
					value = outbreak_chance_black_plague_default_value
					multiply = outbreak_chance_black_plague_mult_value
					multiply = recent_epidemics_outbreak_mult_value
				}
				if = {
					limit = {
						current_date >= 3480.1.1 #EK EDIT EPIDEMICS: historical start of knahaten
						has_game_rule = bd_occurrence_historical
						NOT = {
							has_global_variable = black_death_happened
						}
						geographical_region = ek_knahaten_outbreak_zone #EK EDIT EPIDEMICS: historical start of knahaten
					}
					add = 15000 #EK EDIT EPIDEMICS: let's make very sure, up from 100
				}

				if = {
					limit = {
						# Currently happening
						has_global_variable = black_death
					}
					value = 0
				}
				if = {
					limit = { #it can only happen once per game
						has_global_variable = black_death_happened
						has_game_rule = bd_frequency_once
					}
					value = 0
				}
				if = {
					limit = { #it can never happen
						has_game_rule = bd_frequency_never
					}
					value = 0
				}

				#Historical exemption
				if = {
					limit = {
						has_game_rule = bd_occurrence_historical
						OR = {
							current_date < 3480.1.1 #EK EDIT EPIDEMICS: historical start of knahaten
							NOT = {
								geographical_region = mundus_tamriel_black_marsh_shadowfen #EK EDIT EPIDEMICS: historical start of knahaten
							}
						}
					}
					value = 0
				}
				multiply = 0.1

			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value

				#EK ADDITION EPIDEMICS
				#Exclusions for historical areas
				if = {
					limit = {
						has_game_rule = bd_occurrence_historical
						OR = {
							#historically least affected by knahaten
							geographical_region = mundus_tamriel_morrowind_vvardenfell
							geographical_region = mundus_tamriel_morrowind_telvannis
							geographical_region = mundus_tamriel_skyrim_solstheim
							geographical_region = mundus_tamriel_skyrim_east_ghost
						}
					}
					if = {
						limit = {
							OR = {
								is_riverside_province = yes
								is_coastal = yes
							}
						}
						multiply = 0.4
					}
					else_if = {
						limit = {
							any_neighboring_province = {
								OR = {
									is_riverside_province = yes
									is_coastal = yes
								}
							}
						}
						multiply = 0.32
					}
					else = {
						multiply = 0.025
					}
				}
				if = {
					limit = {
						has_game_rule = bd_occurrence_historical
						geographical_region = mundus_tamriel_morrowind
					}
					multiply = 0.35
				}
				if = {
					limit = {
						has_game_rule = bd_occurrence_historical
						geographical_region = ek_morrowind_knahaten_route
					}
					multiply = 2
				}
				if = {
					limit = {
						has_game_rule = bd_occurrence_historical
						geographical_region = mundus_tamriel_skyrim
					}
					multiply = 0.8
				}
				
				
				#Where it definitely didn't get to (here's everything outside Tamriel)
				if = {
					limit = {
						has_game_rule = bd_occurrence_historical
						OR = {
							geographical_region = mundus_tamriel_yokuda
						}
					}
					multiply = 0.02
				}
				#And now for the opposite: Elsweyr
				if = {
					limit = {
						has_game_rule = bd_occurrence_historical
						geographical_region = mundus_tamriel_elsweyr
					}
					multiply = 4
				}
				#Welcome to 'the Southern Route'. Trade along the southern coast and the abecean was the main spreader, faster than 'the Northern Route'
				if = {
					limit = {
						has_game_rule = bd_occurrence_historical
						geographical_region = ek_valenwood_knahaten_coastal_turbo
					}
					multiply = 3 #this looks high, but there's some pesky impassable coastal mountains in the way
				}
				if = { #Historically turbo spread through the Abecean Sea
					limit = {
						has_game_rule = bd_occurrence_historical
						geographical_region = dlc_fp2_mediterranean_shoreline
					}
					multiply = 1.3
				}
				if = { #Inner Hammerfell is a special case, once the HF Rework is done, this will be adjusted
					limit = {
						has_game_rule = bd_occurrence_historical
						OR = {
							county.duchy = title:d_skaven
							county.duchy = title:d_vulkneu
							county.duchy = title:d_sobatu
							county.duchy = title:d_riverpoint
							county.duchy = title:d_verkarth
							county.duchy = title:d_vulnim
							county = title:c_nohotogrha
							county = title:c_chasetown
						}
					}
					multiply = 0.025
				}
				if = { #Summerset Isles
					limit = {
						has_game_rule = bd_occurrence_historical
						geographical_region = mundus_tamriel_summerset_isles
					}
					if = {
						limit = {
							OR = {
								is_riverside_province = yes
								is_coastal = yes
							}
						}
						multiply = 0.4
					}
					else_if = {
						limit = {
							any_neighboring_province = {
								OR = {
									is_riverside_province = yes
									is_coastal = yes
								}
							}
						}
						multiply = 0.3
					}
					else = {
						multiply = 0.1
					}
				}
				# High Rock was also a bit less affected
				if = {
					limit = {
						has_game_rule = bd_occurrence_historical
						geographical_region = mundus_tamriel_high_rock
						NOT = { county.duchy = title:d_wayrest } #Wayrest was hit hard
					}
					if = {
						limit = {
							OR = {
								is_riverside_province = yes
								is_coastal = yes
							}
						}
						multiply = 0.9
					}
					else_if = {
						limit = {
							any_neighboring_province = {
								OR = {
									is_riverside_province = yes
									is_coastal = yes
								}
							}
						}
						multiply = 0.8
					}
					else = {
						multiply = 0.7
					}
				}

				#This is to offset argonian immunity within spread_chance_epidemics_default_value (applies to all epidemics), so it can historically spread through BM. There it is reduced to 40%, so multiply by 2 = 80%
				if = {
					limit = {
						county.culture = { has_cultural_tradition = tradition_histskin }
					}
					multiply = 2.5
				}
				#Knahaten is spreading from BM to MW a bit too fast, compared to the southern route
				if = {
					limit = {
						has_game_rule = bd_occurrence_historical
						geographical_region = mundus_tamriel_morrowind
						any_neighboring_province = {
							geographical_region = mundus_tamriel_black_marsh
						}
					}
					multiply = 0.1
				}
				#And the same for MW to Skyrim
				if = {
					limit = {
						has_game_rule = bd_occurrence_historical
						geographical_region = mundus_tamriel_skyrim
						any_neighboring_province = {
							geographical_region = mundus_tamriel_morrowind
						}
					}
					multiply = 0.1
				}
				multiply = 0.5 #A bit slower crawl
				#EK ADDITION END			
			}
			max_provinces = { 3750 4750 } #EK EDIT: was 6500 7250, EK2 has far fewer provinces (~5500) than vanilla (~9000), so this needed to be adjusted.

			infection_duration = {
				months = { ek_knahaten_infection_duration_min ek_knahaten_infection_duration_max }
			}
			
			infection_progress_duration = {
				days = { 9 14 } #EK EDIT: was 5 9
			}

			infection_recovery_duration = {
				days = { 80 120 }
			}
		}
	}
	
	on_province_infected = {
		county = {
			apply_infection_development_loss = { BASE = 6 } #EK EDIT: was 10. ek2 plague happens earlier during the gameplay timeline
		}
		every_player = {
			if = {
				limit = {
					NOR = {
						any_owned_story = {
							story_type = story_cycle_black_death
						}
						has_character_flag = black_death_splash #black plague is in your realm
					}
				}
				create_story = story_cycle_black_death
				trigger_event = { #time-based fallback to notify the players that the black death is here.
					id = epidemic_events.5999
					years = { 4 6 } #Average time for Black Death to move from Siberia to Europe
				}
			}
		}
		every_player = {
			if = {
				limit = {
					has_dlc_feature = legends_of_the_dead
					is_landless_ruler = yes
					location = {
						any_province_epidemic = {
							epidemic_type.epidemic_trait = trait:bubonic_plague
							outbreak_intensity = apocalyptic
						}
					}
				}
				trigger_event = epidemic_events.6000
			}
		}
		ek_on_province_infected_peryite_corruption_add = yes # EK ADDITION: chance of peryite corruption
		cant_touch_this_achievement_effect = yes	
		ek_knahaten_global_broadcasts = yes #EK ADDITION: to send broadcasts to every player, based on regions
	}
	
	on_province_recovered = {
		county = {
			remove_isolated_capital_modifiers_effect = yes
			#EK ADDITIONS
			ek_lift_quarantine_for_recovered = yes #EK EDIT: Vanilla kinda forgot to lift quarantines once a province recovered
			if = { #more performant to check if we're even in black marsh before checking for the rest of the effect
				limit = {
					title_province = { geographical_region = mundus_tamriel_black_marsh }
				}
				ek_knahaten_black_marsh_aftereffects = yes #EK ADDITION: to handle post-knahaten BM
			}
			#EK ADDITIONS END
		}
		add_to_variable_list = {
			name = epidemic_cooldown
			target = scope:epidemic.epidemic_type
			years = 50
		}
		set_variable = {
			name = epidemic_cooldown_general
			years = 15 
		}
		# Prosperity event
		plague_recovery_event_effect = yes
		#EK THEYN TODO: this doesn't trigger 
		#EK ADDITION
		#if = {
		#	limit = {
		#		has_game_rule = bd_occurrence_historical
		#		NOT = { exists = global_var:ek_knahaten_broadcasted_elsweyr_recovered }
		#		#if all of elsweyr is knahaten free now
		#		any_county_in_region = {
		#			region = mundus_tamriel_elsweyr
		#			count = 1
		#			any_province_epidemic = {
		#				this = global_var:black_death
		#				outbreak_intensity = apocalyptic
		#			}
		#		}
		#	}
		#	every_player = {
		#		trigger_event = { id = ek_knahaten_events_global.0012 days = { 10 15 }}
		#	}
		#	set_global_variable = {
		#		name = ek_knahaten_broadcasted_elsweyr_recovered
		#		value = yes
		#	}
		#}
		#EK ADDITION END
	}
}

typhus = {
	trait = typhus
	color = { 37 90 57 }
	priority = 4

	shader_data = {
		strength = 0.6
		edge_fade = 0.25
		tile_multiplier = 0.01
		texture_index = 1
		channel = red
	}

	name = {
		first_valid = {
			#EK DISABLED EPIDEMICS: deleted some rl references/easter eggs
			random_valid = {
				triggered_desc = {
					trigger = {
						OR = {
							outbreak_intensity = apocalyptic
							outbreak_intensity = major
						}
					}
					desc = epidemic_rulers_fever
				}
				triggered_desc = {
					trigger = {
						OR = {
							outbreak_intensity = apocalyptic
							outbreak_intensity = major
						}
					}
					desc = epidemic_titled_rulers_fever
				}
				triggered_desc = {
					trigger = {
						OR = {
							outbreak_intensity = apocalyptic
							outbreak_intensity = major
						}
					}
					desc = epidemic_realm_fever
				}
				triggered_desc = {
					trigger = {
						OR = {
							outbreak_intensity = apocalyptic
							outbreak_intensity = major
						}
					}
					desc = epidemic_devils_fever
				}
				desc = epidemic_camp_fever
				desc = epidemic_province_fever
				desc = epidemic_province_sweats
				desc = epidemic_culture_sweats
				desc = epidemic_terrain_fever
				desc = epidemic_famine_fever
				desc = epidemic_spotted_fever
			}
			desc = trait_typhus
		}
	}
	
	on_start = {
		# LEGITIMACY LOSS FROM EPIDEMIC OUTBREAK
		epidemic_outbreak_legitimacy_effect = { PROVINCE = root.outbreak_province }
	}
	
	on_monthly = {
		trigger_event = {
			on_action = epidemic_ongoing_events
		}
	}
	
	character_infection_chance = {
		value = character_infection_chance_default_value
		if = {
			limit = {
				is_commanding_army = yes
			}
			multiply = 4
		}
	}

	can_infect_character = {
		can_contract_disease_trigger = { DISEASE = typhus }
		immune_to_epidemic = { EPIDEMIC = scope:epidemic }
	}

	on_character_infected = {
		contract_disease_notify_effect = { DISEASE = typhus }
	}

	infection_levels = {
		10 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.3
				development_decline = -1
				levy_reinforcement_rate = -0.2
				county_opinion_add = -2
				epidemic_travel_danger = 20
			}	
		}
		50 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.4
				development_decline = -2
				levy_reinforcement_rate = -0.2
				garrison_size = -0.1
				county_opinion_add = -3
				epidemic_travel_danger = 30
			}	
		}
		80 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.5
				development_decline = -3
				levy_reinforcement_rate = -0.2
				garrison_size = -0.2
				county_opinion_add = -5
				epidemic_travel_danger = 40
			}
		}
	}

	outbreak_intensities = {
		minor = {
			outbreak_chance = {
				value = outbreak_chance_minor_default_value
				multiply = outbreak_chance_minor_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				
				### NO DLC - We increase the chance to make up for the locked diseases ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					multiply = 2
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 15 20 } #highly localised

			infection_duration = {
				months = { 6 12 }
			}

			infection_progress_duration = {
				days = 100
			}

			infection_recovery_duration = {
				days = 30
			}
		}

		major = {
			outbreak_chance = {
				value = outbreak_chance_major_default_value
				multiply = outbreak_chance_major_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				multiply = 0.75
				
				### NO DLC - We increase the chance to make up for the locked diseases ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					multiply = 1.5
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 20 30 }

			infection_duration = {
				months = { 12 24 }
			}

			infection_progress_duration = {
				days = { 45 55 }
			}

			infection_recovery_duration = {
				days = { 28 32 }
			}
		}

		apocalyptic = {
			outbreak_chance = {
				value = outbreak_chance_apocalyptic_default_value
				multiply = outbreak_chance_apocalyptic_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				multiply = 0.5
				
				### NO DLC - We increase the chance to make up for the locked diseases ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					multiply = 1.25
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 40 60 }

			infection_duration = {
				months = { 24 48 }
			}
			
			infection_progress_duration = {
				days = { 15 22 }
			}

			infection_recovery_duration = {
				days = { 28 32 }
			}
		}
	}
	
	on_province_infected = {
		county = {
			apply_infection_development_loss = { BASE = 5 }
		}
		cant_touch_this_achievement_effect = yes	
		ek_on_province_infected_peryite_corruption_add = yes # EK ADDITION: chance of peryite corruption
	}
	
	on_province_recovered = {
		county = {
			remove_isolated_capital_modifiers_effect = yes
			ek_lift_quarantine_for_recovered = yes #EK EDIT: Vanilla kinda forgot to lift quarantines once a province recovered
		}
		add_to_variable_list = {
			name = epidemic_cooldown
			target = scope:epidemic.epidemic_type
			years = 50
		}
		set_variable = {
			name = epidemic_cooldown_general
			years = 15 
		}
		# Prosperity event
		plague_recovery_event_effect = yes
	}
}

consumption = { #Tuberculosis
	trait = consumption
	color = { 84 171 176 }
	priority = 1

	shader_data = {
		strength = 0.35
		edge_fade = 0.28
		tile_multiplier = 0.00538
		texture_index = 0
		channel = green
	}

	name = {
		first_valid = {
			#EK DISABLED EPIDEMICS: deleted some rl references/easter eggs
			random_valid = {
				#EK DISABLED EPIDEMICS: deleted some rl references/easter eggs
				triggered_desc = {
					trigger = {
						OR = {
							outbreak_intensity = apocalyptic
							outbreak_intensity = major
						}
					}
					desc = epidemic_titles_evil #King's evil
				}
				#EK DISABLED EPIDEMICS: deleted some rl references/easter eggs
				desc = epidemic_cold_humor
				desc = epidemic_cold_humor
				desc = epidemic_white_plague
				desc = epidemic_realm_flu
				desc = epidemic_realm_coughs
				desc = epidemic_ruler_flu
				desc = epidemic_ruler_coughs
				desc = epidemic_titled_ruler_flu
				desc = epidemic_romantic_plague
				desc = epidemic_holder_flu
				desc = epidemic_holder_coughs
			}
			desc = trait_consumption
		}
	}
	
	on_start = {
		# LEGITIMACY LOSS FROM EPIDEMIC OUTBREAK
		epidemic_outbreak_legitimacy_effect = { PROVINCE = root.outbreak_province }
	}

	on_monthly = {
		trigger_event = {
			on_action = epidemic_ongoing_events
		}
	}

	character_infection_chance = {
		value = character_infection_chance_default_value
	}

	can_infect_character = {
		can_contract_disease_trigger = { DISEASE = consumption }
		immune_to_epidemic = { EPIDEMIC = scope:epidemic }
	}

	on_character_infected = {
		contract_disease_notify_effect = { DISEASE = consumption }
	}

	infection_levels = {
		10 = {
			province_modifier = {
				development_decline = -2
				epidemic_travel_danger = 20
			}
		}
		50 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.05
				development_decline = -3
				county_opinion_add = -2
				epidemic_travel_danger = 40
			}	
		}
		80 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.1
				development_decline = -4
				county_opinion_add = -3
				epidemic_travel_danger = 60
			}
		}
	}

	outbreak_intensities = {
		minor = {
			outbreak_chance = {
				value = outbreak_chance_minor_default_value
				multiply = outbreak_chance_minor_mult_value
				multiply = recent_epidemics_outbreak_mult_value

				#Are you in the consumption zone?
				#EK DISABLED EPIDEMICS: no atlantic, or appropriate equivalent
				#if = {
				#	limit = {
				#		geographical_region = world_atlantic
				#	}
				#	add = outbreak_increase_add_extra_high
				#}
				#else = {
					add = outbreak_decrease_add_high
				#}

				#Endemism
				if = {
					limit = { has_variable = consumption_endemic_variable }
					add = outbreak_increase_add_high
				}
				
				### NO DLC - We increase the chance to make up for the locked diseases ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					multiply = 2
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 15 30 }

			infection_duration = {
				months = { 12 18 } #stays around for a long time
			}

			infection_progress_duration = {
				days = { 80 100 }
			}

			infection_recovery_duration = {
				days = { 30 60 } #stays around for a long time
			}
		}

		major = {
			outbreak_chance = {
				value = outbreak_chance_major_default_value
				multiply = outbreak_chance_major_mult_value
				multiply = recent_epidemics_outbreak_mult_value

				#EK DISABLED EPIDEMICS: no atlantic, or appropriate equivalent
				##Are you in the consumption zone?
				#if = {
				#	limit = {
				#		geographical_region = world_atlantic
				#	}
				#	add = outbreak_increase_add_low
				#}
				#else = {
					add = outbreak_decrease_add_very_high
				#}

				#Endemism
				if = {
					limit = { has_variable = consumption_endemic_variable }
					add = outbreak_increase_add_low
				}
				
				### NO DLC - We increase the chance to make up for the locked diseases ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					multiply = 1.5
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 25 50 }

			infection_duration = {
				months = { 20 25 }
			}

			infection_progress_duration = {
				days = { 40 60 }
			}

			infection_recovery_duration = {
				days = { 60 80 }
			}
		}

		apocalyptic = {
			outbreak_chance = {
				value = outbreak_chance_apocalyptic_default_value
				multiply = outbreak_chance_apocalyptic_mult_value
				multiply = recent_epidemics_outbreak_mult_value

				#Are you in the consumption zone?
				#EK DISABLED EPIDEMICS: no atlantic, or appropriate equivalent
				#if = {
				#	limit = {
				#		geographical_region = world_atlantic
				#	}
				#	multiply = 0.5
				#}
				#else = {
					multiply = 0.25
				#}

				#Endemism
				if = {
					limit = { has_variable = consumption_endemic_variable }
					add = outbreak_increase_add_low
				}
				
				### NO DLC - We increase the chance to make up for the locked diseases ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					multiply = 2
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 80 120 }

			infection_duration = {
				months = { 30 45 }
			}
			
			infection_progress_duration = {
				days = { 15 30 }
			}

			infection_recovery_duration = {
				days = { 80 100 }
			}
		}
	}
	
	on_province_infected = {
		county = {
			apply_infection_development_loss = { BASE = 7 }
		}
		cant_touch_this_achievement_effect = yes	
		ek_on_province_infected_peryite_corruption_add = yes # EK ADDITION: chance of peryite corruption
	}
	
	on_province_recovered = {
		random = { #Endemism
			chance = 10
			set_variable = {
				name = consumption_endemic_variable
				years = 2
			}
		}
		county = {
			remove_isolated_capital_modifiers_effect = yes
			ek_lift_quarantine_for_recovered = yes #EK EDIT: Vanilla kinda forgot to lift quarantines once a province recovered
		}
		add_to_variable_list = {
			name = epidemic_cooldown
			target = scope:epidemic.epidemic_type
			years = 50 #can come back quite fast
		}
		set_variable = {
			name = epidemic_cooldown_general
			years = 15
		}
		# Prosperity event
		plague_recovery_event_effect = yes
	}
}

measles = {
	trait = measles
	color = { 201 111 112 }
	priority = 2

	shader_data = {
		strength = 0.4
		edge_fade = 0.3
		tile_multiplier = 0.006
		texture_index = 0
		channel = blue
	}

	name = {
		first_valid = {
			#EK DISABLED EPIDEMICS: deleted some rl references/easter eggs
			random_valid = {
				triggered_desc = {
				#EK ADDITION: new triggered loc
					trigger = {
						outbreak_intensity = apocalyptic
						}					
					desc = epidemic_evil_god_wrath
				}	
				triggered_desc = {
					trigger = {
						OR = {
							outbreak_intensity = apocalyptic
							outbreak_intensity = major
						}
					}
					desc = epidemic_evil_god_pestilence
				}
				triggered_desc = {
					trigger = {
						OR = {
							outbreak_intensity = apocalyptic
							outbreak_intensity = major
						}
					}
					desc = epidemic_titles_evil #King's evil
				}
				#EK DISABLED EPIDEMICS: deleted some rl references/easter eggs
				desc = epidemic_realm_boils
				desc = epidemic_rulers_boils
				desc = epidemic_titled_rulers_boils
				desc = epidemic_holder_boils
				desc = epidemic_culture_boils
				desc = epidemic_location_boils
				#EK ADDITION EPIDEMICS: added new loc fitting for greenspore
				desc = epidemic_realm_rage
				desc = epidemic_rulers_rage
				desc = epidemic_titled_rulers_rage
				desc = epidemic_holder_rage
				desc = epidemic_culture_rage
				desc = epidemic_location_rage
				desc = epidemic_slaughterfish_frenzy #EK ADDITION
			}
			desc = trait_measles
		}
	}
	
	on_start = {
		# LEGITIMACY LOSS FROM EPIDEMIC OUTBREAK
		epidemic_outbreak_legitimacy_effect = { PROVINCE = root.outbreak_province }
	}

	on_monthly = {
		trigger_event = {
			on_action = epidemic_ongoing_events
		}
	}

	character_infection_chance = {
		value = character_infection_chance_default_value
		multiply = 5 #highly infectious
	}

	can_infect_character = {
		can_contract_disease_trigger = { DISEASE = measles }
		immune_to_epidemic = { EPIDEMIC = scope:epidemic }
	}

	on_character_infected = {
		contract_disease_notify_effect = { DISEASE = measles }
	}

	infection_levels = {
		10 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.1
				epidemic_travel_danger = 5
			}	
		}
		50 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.2
				development_decline = -0.25
				county_opinion_add = -2
				epidemic_travel_danger = 15
			}	
		}
		80 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.4
				development_decline = -0.5
				county_opinion_add = -5
				epidemic_travel_danger = 30
			}
		}
	}

	outbreak_intensities = {
		minor = {
			outbreak_chance = {
				value = outbreak_chance_minor_default_value
				multiply = outbreak_chance_minor_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				#Measles should be pretty common
				multiply = 1.25

				#Endemism
				if = {
					limit = { has_variable = measles_endemic_variable }
					add = outbreak_increase_add_high
				}

				#EK ADDITION EPIDEMICS: Greenspore only occurs in coastal provinces
				if = {
					limit = {
						is_coastal = no
					}
					multiply = 0					
				}
				#EK ADDITION END
				
				### DLC LOCKING ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					value = 0
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 30 40 }

			infection_duration = {
				months = { 3 6 }
			}

			infection_progress_duration = {
				days = { 20 40 }
			}

			infection_recovery_duration = {
				days = { 28 32 }
			}
		}

		major = {
			outbreak_chance = {
				value = outbreak_chance_major_default_value
				multiply = outbreak_chance_major_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				

				#Endemism
				if = {
					limit = { has_variable = measles_endemic_variable }
					add = outbreak_increase_add_medium
				}
				else = {
					multiply = 0.5
				}

				#EK ADDITION EPIDEMICS: Greenspore only occurs in coastal provinces
				if = {
					limit = {
						is_coastal = no
					}
					multiply = 0					
				}
				#EK ADDITION END
				
				### DLC LOCKING ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					value = 0
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 70 100 }

			infection_duration = {
				months = { 6 12 }
			}

			infection_progress_duration = {
				days = { 15 20 }
			}

			infection_recovery_duration = {
				days = { 28 32 }
			}
		}

		apocalyptic = {
			outbreak_chance = {
				value = outbreak_chance_apocalyptic_default_value
				multiply = outbreak_chance_apocalyptic_mult_value
				multiply = recent_epidemics_outbreak_mult_value

				#Endemism
				if = {
					limit = { has_variable = measles_endemic_variable }
					add = outbreak_increase_add_low
				}
				else = {
					multiply = 0.25
				}

				#EK ADDITION EPIDEMICS: Greenspore only occurs in coastal provinces
				if = {
					limit = {
						is_coastal = no
					}
					multiply = 0					
				}
				#EK ADDITION END
				
				### DLC LOCKING ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					value = 0
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 150 225 }

			infection_duration = {
				months = { 12 24 }
			}
			
			infection_progress_duration = {
				days = { 7 14 }
			}

			infection_recovery_duration = {
				days = { 28 32 }
			}
		}
	}
	
	on_province_infected = {
		county = {
			apply_infection_development_loss = { BASE = 5 }
		}
		cant_touch_this_achievement_effect = yes	
		ek_on_province_infected_peryite_corruption_add = yes # EK ADDITION: chance of peryite corruption
	}
	
	on_province_recovered = {
		random = {
			chance = 10
			set_variable = {
				name = measles_endemic_variable
				years = 2
			}
		}
		county = {
			remove_isolated_capital_modifiers_effect = yes
			ek_lift_quarantine_for_recovered = yes #EK EDIT: Vanilla kinda forgot to lift quarantines once a province recovered
		}
		add_to_variable_list = {
			name = epidemic_cooldown
			target = scope:epidemic.epidemic_type
			years = 50
		}
		set_variable = {
			name = epidemic_cooldown_general
			years = 15 
		}
		# Prosperity event
		plague_recovery_event_effect = yes
	}
}

dysentery = {
	trait = dysentery
	color = { 102 0 0 }
	priority = 3

	shader_data = {
		strength = 0.7
		edge_fade = 0.25
		tile_multiplier = 0.01
		texture_index = 1
		channel = green
	}

	name = {
		first_valid = {
			#EK DISABLED EPIDEMICS: deleted some rl references/easter eggs
			random_valid = {
				triggered_desc = {
					trigger = {
						OR = {
							outbreak_intensity = apocalyptic
							outbreak_intensity = major
						}
					}
					desc = epidemic_evil_god_flux
				}
				#EK DISABLED EPIDEMICS: deleted some rl references/easter eggs
				desc = epidemic_realm_flux
				desc = epidemic_ruler_flux
				desc = epidemic_titled_ruler_flux
				desc = epidemic_holder_flux
				desc = epidemic_culture_flux
				desc = epidemic_terrain_flux
				desc = epidemic_location_flux
			}
			desc = trait_dysentery
		}
	}
	
	on_start = {
		# LEGITIMACY LOSS FROM EPIDEMIC OUTBREAK
		epidemic_outbreak_legitimacy_effect = { PROVINCE = root.outbreak_province }
	}

	on_monthly = {
		trigger_event = {
			on_action = epidemic_ongoing_events
		}
	}

	character_infection_chance = {
		value = character_infection_chance_default_value
		multiply = 3.5 #highly infectious
		if = {
			limit = {
				is_commanding_army = yes
			}
			multiply = 2
		}
	}

	can_infect_character = {
		can_contract_disease_trigger = { DISEASE = dysentery }
		immune_to_epidemic = { EPIDEMIC = scope:epidemic }
	}

	on_character_infected = {
		contract_disease_notify_effect = { DISEASE = dysentery }
	}

	infection_levels = {
		10 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.15
				county_opinion_add = -2
				epidemic_travel_danger = 10
				development_decline = -1.5
			}	
		}
		50 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.3
				development_decline = -2.5
				supply_limit_mult = -0.1
				county_opinion_add = -3
				epidemic_travel_danger = 20
			}	
		}
		80 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.5
				development_decline = -4
				supply_limit_mult = -0.2
				county_opinion_add = -5
				epidemic_travel_danger = 30
			}
		}
	}

	outbreak_intensities = {
		minor = {
			outbreak_chance = {
				value = outbreak_chance_dysentery_default_value #special values for armies here
				multiply = outbreak_chance_minor_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				
				### DLC LOCKING ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					value = 0
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {  
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}

			max_provinces = { 10 16 }
			
			infection_duration = {
				months = { 2 4 }
			}

			infection_progress_duration = {
				days = { 15 20 }
			}

			infection_recovery_duration = {
				days = { 28 32 }
			}
		}

		major = {
			outbreak_chance = {
				value = outbreak_chance_dysentery_default_value #special values for armies here
				multiply = outbreak_chance_major_mult_value
				multiply = recent_epidemics_outbreak_mult_value 
				multiply = 0.25
				
				### DLC LOCKING ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					value = 0
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {  
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 22 30 }

			infection_duration = {
				months = { 8 16 }
			}

			infection_progress_duration = {
				days = { 18 22 }
			}

			infection_recovery_duration = {
				days = { 28 32 }
			}
		}

		apocalyptic = {
			outbreak_chance = {
				value = outbreak_chance_dysentery_default_value #special values for armies here
				multiply = outbreak_chance_apocalyptic_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				multiply = 0.15
				
				### DLC LOCKING ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					value = 0
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {  
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 50 150 }

			infection_duration = {
				months = { 16 32 }
			}
			
			infection_progress_duration = {
				days = { 10 15 }
			}

			infection_recovery_duration = {
				days = { 28 32 }
			}
		}
	}
	
	on_province_infected = {
		county = {
			apply_infection_development_loss = { BASE = 3 }
		}
		cant_touch_this_achievement_effect = yes
		ek_on_province_infected_peryite_corruption_add = yes # EK ADDITION: chance of peryite corruption		
	}
	
	on_province_recovered = {
		county = {
			remove_isolated_capital_modifiers_effect = yes
			ek_lift_quarantine_for_recovered = yes #EK EDIT: Vanilla kinda forgot to lift quarantines once a province recovered
		}
		add_to_variable_list = {
			name = epidemic_cooldown
			target = scope:epidemic.epidemic_type
			years = 50
		}
		set_variable = {
			name = epidemic_cooldown_general
			years = 15 
		}
		# Prosperity event
		plague_recovery_event_effect = yes
	}
}

ergotism = { #dancing plague - not contagious
	trait = ergotism
	color = { 255 95 31 }
	priority = 2

	shader_data = {
		strength = 0.5
		edge_fade = 0.25
		tile_multiplier = 0.005
		texture_index = 1
		channel = alpha
	}

	name = {
		first_valid = {
			#EK DISABLED EPIDEMICS: deleted some rl references/easter eggs
			triggered_desc = {
				trigger = {
					outbreak_intensity = apocalyptic
				}
				desc = epidemic_dance_of_death
			}
			#EK ADDITION: if the origin province somehow venerates sanguine, it has to relate to him!
			triggered_desc = {
				trigger = {
					outbreak_province = {
						county = {
							faith = {
								has_doctrine = doctrine_sanguine_pantheon
							}
						}
					}
				}
				desc = epidemic_sanguines_dance
			}
			#EK ADDITION END
			random_valid = {
				#EK DISABLED EPIDEMICS: deleted some rl references/easter eggs
				triggered_desc = {
					trigger = {
						outbreak_province = {
							county = { development_level <= 5 }
						}
					}
					desc = epidemic_realm_dancing_plague
				}
				triggered_desc = {
					trigger = {
						outbreak_province = {
							county = { development_level <= 5 }
						}
					}
					desc = epidemic_culture_dancing_plague
				}
				triggered_desc = {
					trigger = {
						outbreak_province = {
							county = { development_level <= 5 }
						}
					}
					desc = epidemic_location_dancing_plague
				}
				#EK DISABLED EPIDEMICS: deleted some rl references/easter eggs
				desc = epidemic_realm_fire
				desc = epidemic_culture_fire
				desc = epidemic_location_fire
				desc = epidemic_ruler_fire
				desc = epidemic_holder_fire
				desc = epidemic_evil_god_fire
				desc = epidemic_collywobbles #EK ADDITION
			}
		}
	}
	
	on_start = {
		# LEGITIMACY LOSS FROM EPIDEMIC OUTBREAK
		epidemic_outbreak_legitimacy_effect = { PROVINCE = root.outbreak_province }
	}
	
	on_monthly = {
		trigger_event = {
			on_action = epidemic_ongoing_events
		}
	}

	character_infection_chance = {
		value = character_infection_chance_default_value
	}

	can_infect_character = {
		can_contract_disease_trigger = { DISEASE = ergotism }
		immune_to_epidemic = { EPIDEMIC = scope:epidemic }
	}

	on_character_infected = {
		contract_disease_notify_effect = { DISEASE = ergotism }
	}

	infection_levels = {
		10 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.1
				holding_build_speed = 0.5 #this is negative
				stationed_maa_toughness_mult = -0.1
				supply_limit_mult = -0.1 #food related
				epidemic_travel_danger = 5
			}	
		}
		50 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.15
				holding_build_speed = 0.75
				stationed_maa_toughness_mult = -0.2
				supply_limit_mult = -0.2
				epidemic_travel_danger = 10
			}	
		}
		80 = {
			province_modifier = {
				development_decline = -0.5
				monthly_county_control_decline_add = -0.15
				holding_build_speed = 1
				stationed_maa_toughness_mult = -1
				supply_limit_mult = -0.3
				epidemic_travel_danger = 15
			}
		}
	}

	outbreak_intensities = {
		minor = {
			outbreak_chance = {
				value = outbreak_chance_minor_default_value
				multiply = outbreak_chance_minor_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				multiply = 0.5 #shouldn't happen often
				if = { #Recent epidemics
					limit = {
						is_target_in_variable_list = {
							name = epidemic_cooldown
							target = epidemic_type:ergotism
						}
					}
					value = 0
				}
				
				### DLC LOCKING ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					value = 0
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
				if = {
					limit = {
						is_target_in_variable_list = {
							name = epidemic_cooldown
							target = scope:epidemic.epidemic_type
						}
					}
					value = 0
				}
			}

			max_provinces = { 10 15 }

			infection_duration = {
				months = { 6 12 }
			}

			infection_progress_duration = {
				days = { 20 40 }
			}

			infection_recovery_duration = {
				days = { 12 20 }
			}
		}
		major = { 
			outbreak_chance = {
				value = outbreak_chance_major_default_value
				multiply = outbreak_chance_major_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				multiply = 0.2 #shouldn't happen often
				if = { #Recent epidemics
					limit = {
						is_target_in_variable_list = {
							name = epidemic_cooldown
							target = epidemic_type:ergotism
						}
					}
					value = 0
				}
				
				### DLC LOCKING ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					value = 0
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
				if = {
					limit = {
						is_target_in_variable_list = {
							name = epidemic_cooldown
							target = scope:epidemic.epidemic_type
						}
					}
					value = 0
				}
			}

			max_provinces = { 25 35 }

			infection_duration = {
				months = { 12 18 }
			}

			infection_progress_duration = {
				days = { 20 40 }
			}

			infection_recovery_duration = {
				days = { 12 20 }
			}
		}
		apocalyptic = { 
			outbreak_chance = {
				value = outbreak_chance_apocalyptic_default_value
				multiply = outbreak_chance_apocalyptic_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				multiply = 0.1 #shouldn't happen often
				if = { #Recent epidemics
					limit = {
						is_target_in_variable_list = {
							name = epidemic_cooldown
							target = epidemic_type:ergotism
						}
					}
					value = 0
				}
				
				### DLC LOCKING ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					value = 0
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
				if = {
					limit = {
						is_target_in_variable_list = {
							name = epidemic_cooldown
							target = scope:epidemic.epidemic_type
						}
					}
					value = 0
				}
			}

			max_provinces = { 40 50 }

			infection_duration = {
				months = { 24 30 }
			}

			infection_progress_duration = {
				days = { 20 40 }
			}

			infection_recovery_duration = {
				days = { 12 20 }
			}
		}
	}
	
	on_province_recovered = {
		county = {
			remove_isolated_capital_modifiers_effect = yes
			ek_lift_quarantine_for_recovered = yes #EK EDIT: Vanilla kinda forgot to lift quarantines once a province recovered
		}
		add_to_variable_list = {
			name = epidemic_cooldown
			target = scope:epidemic.epidemic_type
			years = 50
		}
		set_variable = {
			name = epidemic_cooldown_general
			years = 15
		}
		# Prosperity event
		plague_recovery_event_effect = yes
	}
}


# EK ADDITION: New epidemic
chrondiasis = { #Chrondiasis
	trait = chrondiasis
	color = { 95 10 95 }
	priority = 1

	shader_data = {
		strength = 0.35
		edge_fade = 0.3
		tile_multiplier = 0.008
		texture_index = 0
		channel = blue
	}

	name = {
		first_valid = {
			triggered_desc = {
				trigger = {
					outbreak_intensity = apocalyptic
				}
				desc = epidemic_brain_rot
			}
			triggered_desc = {
				trigger = {
					outbreak_intensity = major
				}
				desc = epidemic_mage_bane
			}
			random_valid = {
				desc = epidemic_ruler_witbane
				desc = epidemic_titled_ruler_witbane
				desc = epidemic_holder_witbane
				desc = epidemic_culture_witbane
				desc = epidemic_wizard_fever
				desc = epidemic_astral_vapors
			}
			desc = trait_chrondiasis
		}
	}
	
	on_start = {
		# LEGITIMACY LOSS FROM EPIDEMIC OUTBREAK
		epidemic_outbreak_legitimacy_effect = { PROVINCE = root.outbreak_province }
	}

	on_monthly = {
		trigger_event = {
			on_action = epidemic_ongoing_events
		}
	}

	character_infection_chance = {
		value = character_infection_chance_default_value
	}

	can_infect_character = {
		can_contract_disease_trigger = { DISEASE = chrondiasis }
		immune_to_epidemic = { EPIDEMIC = scope:epidemic }
	}

	on_character_infected = {
		contract_disease_notify_effect = { DISEASE = chrondiasis }
	}

	infection_levels = {
		10 = {
			province_modifier = {
				development_decline = -1
				epidemic_travel_danger = 20
			}
		}
		50 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.05
				development_decline = -2
				county_opinion_add = -2
				epidemic_travel_danger = 40
			}	
		}
		80 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.1
				development_decline = -3
				county_opinion_add = -4
				epidemic_travel_danger = 60
			}
		}
	}

	outbreak_intensities = {
		minor = {
			outbreak_chance = {
				value = outbreak_chance_minor_default_value
				multiply = outbreak_chance_minor_mult_value
				multiply = recent_epidemics_outbreak_mult_value

				add = outbreak_decrease_add_high

				multiply = 0.5

				#Endemism
				if = {
					limit = { has_variable = chrondiasis_endemic_variable }
					add = outbreak_increase_add_high
				}

				if = {
					limit = {
						county.culture = { culture_is_magic_focused = yes }					
					}
					multiply = 2
				}
				
				### NO DLC - We increase the chance to make up for the locked diseases ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					multiply = 2
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 15 30 }

			infection_duration = {
				months = { 12 18 } #stays around for a long time
			}

			infection_progress_duration = {
				days = { 80 100 }
			}

			infection_recovery_duration = {
				days = { 30 60 } #stays around for a long time
			}
		}

		major = {
			outbreak_chance = {
				value = outbreak_chance_major_default_value
				multiply = outbreak_chance_major_mult_value
				multiply = recent_epidemics_outbreak_mult_value

				add = outbreak_decrease_add_very_high

				multiply = 0.5

				#Endemism
				if = {
					limit = { has_variable = chrondiasis_endemic_variable }
					add = outbreak_increase_add_low
				}

				if = {
					limit = {
						county.culture = { culture_is_magic_focused = yes }					
					}
					multiply = 2
				}
				
				### NO DLC - We increase the chance to make up for the locked diseases ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					multiply = 1.5
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 25 50 }

			infection_duration = {
				months = { 20 25 }
			}

			infection_progress_duration = {
				days = { 40 60 }
			}

			infection_recovery_duration = {
				days = { 60 80 }
			}
		}

		apocalyptic = {
			outbreak_chance = {
				value = outbreak_chance_apocalyptic_default_value
				multiply = outbreak_chance_apocalyptic_mult_value
				multiply = recent_epidemics_outbreak_mult_value

				multiply = 0.75

				#Endemism
				if = {
					limit = { has_variable = chrondiasis_endemic_variable }
					add = outbreak_increase_add_low
				}

				if = {
					limit = {
						county.culture = { culture_is_magic_focused = yes }					
					}
					multiply = 2
				}
				
				### NO DLC - We increase the chance to make up for the locked diseases ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					multiply = 2
				}
				if = {
					limit = {
						has_game_rule = epidemic_frequency_disabled
					}
					multiply = 0
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 80 120 }

			infection_duration = {
				months = { 30 45 }
			}
			
			infection_progress_duration = {
				days = { 15 30 }
			}

			infection_recovery_duration = {
				days = { 80 100 }
			}
		}
	}
	
	on_province_infected = {
		county = {
			apply_infection_development_loss = { BASE = 7 }
		}
		cant_touch_this_achievement_effect = yes	
		ek_on_province_infected_peryite_corruption_add = yes # EK ADDITION: chance of peryite corruption
	}
	
	on_province_recovered = {
		random = { #Endemism
			chance = 10
			set_variable = {
				name = chrondiasis_endemic_variable
				years = 2
			}
		}
		county = {
			remove_isolated_capital_modifiers_effect = yes
		}
		add_to_variable_list = {
			name = epidemic_cooldown
			target = scope:epidemic.epidemic_type
			years = 50 #can come back quite fast
		}
		set_variable = {
			name = epidemic_cooldown_general
			years = 15
		}
		# Prosperity event
		plague_recovery_event_effect = yes
	}
}

peryite_affliction = { # Peryites Affliction
	trait = peryite_affliction
	color = { 10 95 25 }
	priority = 1

	shader_data = {
		strength = 0.35
		edge_fade = 0.3
		tile_multiplier = 0.008
		texture_index = 0
		channel = green
	}

	name = {
		first_valid = {
			random_valid = {
				desc = epidemic_peryites_curse
				desc = epidemic_blighted_lords_blessing
				desc = epidemic_dragons_plague
				desc = epidemic_taskmasters_responsibility
				desc = epidemic_sacred_skeevers_kiss
			}
			desc = trait_peryite_affliction
		}
	}
	
	on_start = {
		# LEGITIMACY LOSS FROM EPIDEMIC OUTBREAK
		epidemic_outbreak_legitimacy_effect = { PROVINCE = root.outbreak_province }
	}

	on_monthly = {
		trigger_event = {
			on_action = epidemic_ongoing_events
		}
	}

	character_infection_chance = {
		value = character_infection_chance_default_value
	}

	can_infect_character = {
		can_contract_disease_trigger = { DISEASE = peryite_affliction }
		immune_to_epidemic = { EPIDEMIC = scope:epidemic }
	}

	on_character_infected = {
		contract_disease_notify_effect = { DISEASE = peryite_affliction }
	}

	infection_levels = {
		10 = {
			province_modifier = {
				development_decline = -1
				epidemic_travel_danger = 20
			}
		}
		50 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.05
				development_decline = -2
				county_opinion_add = -2
				epidemic_travel_danger = 40
			}	
		}
		80 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.1
				development_decline = -3
				county_opinion_add = -4
				epidemic_travel_danger = 60
			}
		}
	}

	outbreak_intensities = {
		minor = {
			outbreak_chance = {
				value = 0 # only triggered through events
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 25 50 }

			infection_duration = {
				months = { 20 25 }
			}

			infection_progress_duration = {
				days = { 40 60 }
			}

			infection_recovery_duration = {
				days = { 60 80 }
			}
		}

		major = {
			outbreak_chance = {
				value = 0 # only triggered through events
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 80 120 }

			infection_duration = {
				months = { 30 45 }
			}
			
			infection_progress_duration = {
				days = { 15 30 }
			}

			infection_recovery_duration = {
				days = { 80 100 }
			}
		}

		apocalyptic = {
			outbreak_chance = {
				value = 0 # only triggered through events
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 100 140 }

			infection_duration = {
				months = { 45 60 }
			}
			
			infection_progress_duration = {
				days = { 10 20 }
			}

			infection_recovery_duration = {
				days = { 100 120 }
			}
		}
	}
	
	on_province_infected = {
		county = {
			apply_infection_development_loss = { BASE = 7 }
		}
		cant_touch_this_achievement_effect = yes
		ek_on_province_infected_peryite_corruption_add = yes # EK ADDITION: chance of peryite corruption		
	}
	
	on_province_recovered = {
		county = {
			remove_isolated_capital_modifiers_effect = yes
		}
		add_to_variable_list = {
			name = epidemic_cooldown
			target = scope:epidemic.epidemic_type
			years = 50 #can come back quite fast
		}
		set_variable = {
			name = epidemic_cooldown_general
			years = 15
		}
		# Prosperity event
		plague_recovery_event_effect = yes
	}
}