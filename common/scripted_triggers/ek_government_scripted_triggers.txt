### To replace most of the faith = { religion_tag = islam_religion }, in case we ever want to re-add Clan government
has_feudal_like_government = {
	OR = {
		government_has_flag = government_is_feudal
		government_has_flag = government_is_clan
		government_has_flag = government_is_autocracy
		government_has_flag = government_is_hierocracy
	}
}

has_feudal_or_admin_government = { #Mostly for decisions
	OR = {
		has_feudal_like_government = yes
		government_has_flag = government_is_administrative
	}
}

### For government types that have similar succession laws to feudal
has_feudal_like_succession = {
	OR = {
		government_has_flag = government_is_feudal
		government_has_flag = government_is_clan
		government_has_flag = government_is_autocracy
	}
}

government_has_vassal_contract = { # In vanilla only feudal_government uses vassal contract
	OR = {
		# Vanilla - Playable
		government_has_flag = government_is_feudal
		government_has_flag = government_is_clan
		government_has_flag = government_is_tribal
		
		# Vanilla - Unplayable
		government_has_flag = government_is_republic
		government_has_flag = government_is_theocracy
		
		# EK
		government_has_flag = government_is_hierocracy
		government_has_flag = government_is_autocracy
		government_has_flag = government_is_landed_order
	}
}

should_use_clan_government = {
	always = no
}
should_use_feudal_government = {
	NOT = { 
		has_government = administrative_government #Admin people should stay admin
	}
	culture = { has_cultural_parameter = unlocks_feudal_government }
	exists = capital_province
	trigger_if = {
		limit = { exists = capital_province }
		capital_province = { has_holding_type = castle_holding }
	}
}
should_use_praxis_mechanics = {
	culture = { has_cultural_parameter = uses_praxis_mechanics }
	faith = {
		has_doctrine = tenet_legalism
		has_doctrine = tenet_divine_purity
		has_doctrine = doctrine_pantheon_aedra
	}
}
uses_praxis_mechanics = {
	#If dlc is enabled then it's only for admin altmers, otherwise check for elective
	OR = {
		primary_title.state_faith ?= faith:auriel
		has_realm_law = xarxean_investiture_succession_law
		primary_title = { has_title_law = altmeri_elective_succession_law }
	}
}
should_use_hierocracy_government = {
	faith = {
		has_doctrine_parameter = hof_is_hierocracy
		religious_head = prev
	}
}
should_use_autocracy_government = {
	NOR = {
		should_use_clan_government = yes
		should_use_feudal_government = yes
		should_use_hierocracy_government = yes
		should_use_landed_order_government = yes
	}
}

should_use_landed_order_government = {
	OR = {
		has_primary_title = title:d_dawnguard
		has_primary_title = title:d_pale_watch
		has_primary_title = title:b_jorrvaskr
	}
}

# Obligations level
# We need scope:liege, scope:vassal, and OBLIGATION_LEVEL (none/opinion/devotion/fame/prowess/...)
vassal_should_use_obligation = {
	trigger_if = {
		limit = { $OBLIGATION_LEVEL$ = flag:prowess }
		custom_tooltip = {
			text = prowess_obligations_requirement
			scope:vassal = { can_use_obligation_prowess = yes }
		}
	}
	trigger_else_if = {
		limit = { $OBLIGATION_LEVEL$ = flag:arcana }
		custom_tooltip = {
			text = arcana_obligations_requirement
			scope:vassal = {
				can_use_obligation_arcana = yes
				NOT = { has_unique_obligation_level = yes }
			}
		}
	}
	trigger_else_if = {
		limit = { $OBLIGATION_LEVEL$ = flag:fame }
		scope:vassal = {
			can_use_obligation_fame = yes
			NOT = { has_unique_obligation_level = yes }
		}
	}
	trigger_else_if = {
		limit = { $OBLIGATION_LEVEL$ = flag:devotion }
		custom_tooltip = {
            text = devotion_obligations_requirement
            OR = {
                scope:vassal = {
                    can_use_obligation_devotion = yes
                    NOT = { has_unique_obligation_level = yes }
                }
                scope:liege = { has_government = hierocracy_government }
            }    
        }    
	}
	trigger_else_if = {
		limit = { $OBLIGATION_LEVEL$ = flag:opinion }
		scope:vassal = {
			NOR = {
				government_has_flag = government_is_feudal
				# Band-aix fix, have that one as the default for non-feudal
				# can_use_obligation_prowess = yes
				# can_use_obligation_arcana = yes
				# can_use_obligation_fame = yes
				# can_use_obligation_devotion = yes
			}
		}
	}
	trigger_else_if = {
		limit = { $OBLIGATION_LEVEL$ = flag:none }
		always = yes
	}
	trigger_else = {
		always = no
	}
}

government_uses_obligations = {
	OR = {
		government_has_flag = government_is_tribal
		government_has_flag = government_is_hierocracy
		government_has_flag = government_is_landed_order
	}
}

can_use_obligation_prowess = {
	faith = { has_doctrine_parameter = vassal_contribution_tied_prowess }
}

can_use_obligation_arcana = {
	OR = {
		AND = {
			exists = dynasty
			dynasty = { has_dynasty_perk = magicka_legacy_4 }
		}
		culture = { has_cultural_parameter = vassal_contribution_tied_arcana } 
		culture = { has_cultural_parameter = sorcerer_kings_tradition }
	}
}

can_use_obligation_fame = {
	government_has_flag = government_is_tribal
}

can_use_obligation_devotion = {
	government_has_flag = government_is_theocracy
}

has_unique_obligation_level = {
	OR = {
		has_culture_obligation_level = yes
		has_faith_obligation_level = yes
	}
}

has_culture_obligation_level = {
	always = no
}

has_faith_obligation_level = {
	faith = { has_doctrine_parameter = vassal_contribution_tied_prowess }
}

is_great_house_head = {
	OR = {
		has_title = title:k_hlaalu
		has_title = title:k_dres
		has_title = title:k_redoran
		has_title = title:k_indoril
		has_title = title:k_telvanni
	}
}

special_succession_moot_trigger = {
	culture = { has_cultural_parameter = moot_elective_enabled }
}

special_succession_sorcerous_trigger = {
	OR = {
		AND = {
			exists = dynasty
			dynasty = { has_dynasty_perk = magicka_legacy_4 }
		}
		culture = { has_cultural_parameter = magic_elective_enabled }
		culture = { has_cultural_parameter = sorcerer_kings_tradition }
	}
}

special_succession_magelord_trigger = {
	OR = { #Telvanni
		culture = { has_cultural_tradition = tradition_parliament_of_bugs }
	}
	OR = {
		AND = {
			exists = dynasty
			dynasty = { has_dynasty_perk = magicka_legacy_4 }
		}
		culture = { has_cultural_parameter = magic_elective_enabled }
		culture = { has_cultural_parameter = sorcerer_kings_tradition }
	}
}

special_succession_altmeri_trigger = {
	culture = { has_cultural_parameter = uses_praxis_mechanics }
	faith = {
		has_doctrine = tenet_legalism
		has_doctrine = tenet_divine_purity
		has_doctrine = doctrine_pantheon_aedra
	}
}

check_autocracy_tax_collector_aptitude = {
	$CHARACTER$ = {
		tax_collector_aptitude = {
			tax_slot_type = autocracy_tax_slot
			value = $VALUE$
		}
	}
}

check_hierocracy_tax_collector_aptitude = {
	$CHARACTER$ = {
		tax_collector_aptitude = {
			tax_slot_type = hierocracy_tax_slot
			value = $VALUE$
		}
	}
}