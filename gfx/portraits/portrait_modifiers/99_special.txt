#EK EDIT several edits

special_eyelashes = {

	usage = game

	eyelashes = {
		dna_modifiers = {
			accessory = {
				mode = replace
				gene = eyelashes_accessory
				template = no_eyelashes
				value = 0.5
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 200
				scope:age < 10
			}
		}
	}

}

weight = {
	usage = game

	@overweight_multiplier = 0.5
	@underweight_multiplier = -0.5

	overweight = {
		ignore_outfit_tags = yes
		dna_modifiers = {
			morph = {
				mode = modify
				gene = gene_bs_body_type
				value = {
					value = scope:weight_for_portrait # An absolute and normalized value derived from character body weight
					multiply = @overweight_multiplier
				}
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 100
				scope:current_weight > overweight_threshold
			}
			modifier = {
                add = -100
				exists = this
                has_character_flag = has_scripted_weight
            }
		}
	}

	underweight = {
		ignore_outfit_tags = yes
		dna_modifiers = {
			morph = {
				mode = modify
				gene = gene_bs_body_type
				value = {
					value = scope:weight_for_portrait # An absolute and normalized value derived from character body weight
					multiply = @underweight_multiplier
				}
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 100
				scope:current_weight < underweight_threshold
			}
			modifier = {
                add = -100
				exists = this
                has_character_flag = has_scripted_weight
            }
		}
	}

	ruler_designer_overweight = {
		dna_modifiers = {
			morph = {
				mode = modify
				gene = gene_bs_body_type
				value = {
					value = scope:weight_for_portrait # An absolute and normalized value derived from character body weight
					multiply = @overweight_multiplier
				}
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 100
				exists = scope:ruler_designer
				scope:current_weight > overweight_threshold
			}
		}
	}
	ruler_designer_underweight = {
		dna_modifiers = {
			morph = {
				mode = modify
				gene = gene_bs_body_type
				value = {
					value = scope:weight_for_portrait # An absolute and normalized value derived from character body weight
					multiply = @underweight_multiplier
				}
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 100
				exists = scope:ruler_designer
				scope:current_weight < underweight_threshold
			}
		}
	}
}

@muscle_multiply = 1
@muscle_max = 1.0

muscularity = {

	usage = game
	
	muscular = {
		ignore_outfit_tags = yes
		dna_modifiers = {
			morph = {
				mode = modify
				gene = gene_bs_body_shape
				value = {
					value = 0

					if = { 
						limit = { exists = scope:ruler_designer }
						add = scope:prowess
					}
					else_if = {
						limit = { exists = this }
						add = prowess_for_portrait
					}
					else = {
						add = scope:prowess
					}

					multiply = 2

					max = 1.0
				}
			}
		}
		weight = {
			base = 100
		}
	}
}

special_pregnancy = {

	usage = game

	pregnant = {
		ignore_outfit_tags = yes
		dna_modifiers = {
			morph = {
				mode = add
				gene = gene_bs_pregnant
				template = pregnant
				value = {
					value = 1
					if = {
						# Overweight females should have less visible pregnancy, so we change the 100% pregnant value
						limit = { current_weight > overweight_threshold }
						value = scope:weight_for_portrait # An absolute and normalized value derived from character body weight
						multiply = -1.0 
						add = 1.5
						max = 1.0
					}
					if = {
						limit = {  
							always = yes
							#NOT = { this = character:animation_test_female_pregnant }
						}
						multiply = {
							add = pregnancy_days
							# Only change every 10 days
							divide = 10
							round = yes
							multiply = 10
							divide = 250 # PREGNANCY_DAYS is 280; we want 1 month at 100%
							max = 1
						}
					}					
				}
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 100
				portrait_has_trait_trigger = { TRAIT = pregnant }
			}			
		}
	}
}


special_shrink_body = {
	
	usage = game
	shrink_body = {
		dna_modifiers = {
			morph = {
				mode = add
				gene = gene_shrink_body
				template = shrink_all
				value = 1 # For the randomness to work correctly
			}
		}   
		weight = {
			base = 10
		}
	}
}

additive_headgears = {

	usage = game
	additive_headgears = {
			dna_modifiers = {
			morph = {
				mode = add
				gene = gene_bs_additive_headgears
				template = additive_headgears
				value = 1 # For the randomness to work correctly
			}
		}
	}
}

cloak_offset = {

	usage = game
	cloak_offset = {
			dna_modifiers = {
			morph = {
				mode = add
				gene = gene_bs_cloak_offset
				template = cloak_offset
				value = 1 # For the randomness to work correctly
			}
		}
	}
}

long_beard = {

	usage = game
	long_beard = {
			dna_modifiers = {
			morph = {
				mode = add
				gene = gene_bs_long_beard
				template = long_beard
				value = 1 # For the randomness to work correctly
			}
		}
	}
}

special_beardless_eunuch = {

	usage = game
	selection_behavior = weighted_random

	no_body_hair = { # Has no portrait 
		dna_modifiers = {
			morph = {
				mode = replace
				gene = gene_body_hair
				template = body_hair_sparse
				value = 0
			} 
			accessory = {
                mode = add
                gene = beards
                template = no_beard
                range = { 0 1 } # For the randomness to work correctly
            } 
		}
		weight = {
			base = 0
			modifier = {
				add = 999
				has_trait = beardless_eunuch
			}
		}
	}
}

special_line_of_x = {
    usage = game
    selection_behavior = weighted_random
    priority = 50
### EK EDIT: Re-use the special code for the Prophet Muhammad for the "Line of X" characters
## So that the Prophet Muhammad does not have a portrait ## 

	no_portrait = {
		dna_modifiers = {
			morph = {
				mode = replace				
				gene = gene_bs_body_type
				template = no_portrait
				value = 1.0
			}
			morph = {
				mode = replace				
				gene = complexion
				template = complexion_no_face
				value = 1.0
			}
			morph = {
				mode = replace				
				gene = gene_age
				template = no_aging
				value = 1.0
			}
			morph = {
				mode = modify				
				gene = gene_eyebrows_shape
				template = no_eyebrows
				value = 0.5
			}
			morph = {
				mode = modify				
				gene = gene_eyebrows_fullness
				template = no_eyebrows
				value = 0.5
			}
			accessory = {
				mode = add
				gene = headgear
				template = no_headgear
				range = { 0 1 } # For the randomness to work correctly
			}			
			accessory = {
				mode = add				
				gene = clothes
				template = no_clothes
				value = 0.5
			}
			accessory = {
				mode = add
				gene = cloaks
				template = no_cloak
				range = { 0 1 } # For the randomness to work correctly
			}
			accessory = {
				mode = add
				gene = legwear
				template = no_legwear
				range = { 0 1 } # For the randomness to work correctly
			}			
			accessory = {
				mode = modify				
				gene = eye_L_accessory
				template = no_eye
				value = 0.5
			}
			accessory = {
				mode = modify				
				gene = eye_R_accessory
				template = no_eye
				value = 0.5
			}
			accessory = {
				mode = modify				
				gene = teeth_accessory
				template = no_teeth
				value = 0.5
			}
			accessory = {
				mode = add				
				gene = props_left
				template = prophet_shield
				value = 0.5
			}

		}
		weight = {
			base = 0
			modifier = {
				add = 999
				has_trait = line_of_x
			}
		}
	}
}

ek_undead_decay_base = {
	usage = game
    priority = 49
	decay_base = {
		dna_modifiers = {
			morph = {
				mode = add
				gene = draugr
				template = draugr_bs
				value = {
					var:ek_undead_decay ?= {value = this}
				}
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 200
				is_alive = yes
				is_undead = yes
				has_character_flag = has_decay_value
				NOT = { has_character_modifier = modifier_ritual_conceal }
			}
		}
	}
	decay_dead_fallback = { # since characters lose variables and flags on death, this will default dead undead characters to appear as skeletons, so that they dont magically restore their skin as soon as they're killed
		dna_modifiers = {
			morph = {
				mode = add
				gene = draugr
				template = draugr_bs
				value = 1.0
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 200
				is_alive = no
				is_undead = yes
			}
		}
	}	
}
ek_undead_decay_skeleton = {
	usage = game
    priority = 49
	decay_skeleton = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = race_beast_body_shaders
				template = skeleton_body
				value = 1.0
			}
			accessory = {
				mode = add
				gene = race_beast_head_shaders
				template = skeleton_head
				value = 1.0
			}			
			accessory = {
				mode = modify				
				gene = teeth_accessory
				template = no_teeth
				value = 0.5
			}
			accessory = {
				mode = modify				
				gene = eyelashes_accessory
				template = no_eyelashes
				value = 0.5
			}
			accessory = {
				mode = modify				
				gene = tails
				template = no_tail
				value = 0.5
			}
			accessory = {
				mode = modify				
				gene = beast_head_attachment_02
				template = no_attachment_02
				value = 0.5
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 200
				is_alive = yes
				is_undead = yes
				has_character_flag = has_decay_value
				var:ek_undead_decay >= 0.6
				NOT = { has_character_modifier = modifier_ritual_conceal }
			}
		}
	}
	decay_skeleton_dead_fallback = {	# since characters lose variables and flags on death, this will default dead undead characters to appear as skeletons, so that they dont magically restore their skin as soon as they're killed
		dna_modifiers = {
			accessory = {
				mode = add
				gene = race_beast_body_shaders
				template = skeleton_body
				value = 1.0
			}
			accessory = {
				mode = add
				gene = race_beast_head_shaders
				template = skeleton_head
				value = 1.0
			}			
			accessory = {
				mode = modify				
				gene = teeth_accessory
				template = no_teeth
				value = 0.5
			}
			accessory = {
				mode = modify				
				gene = eyelashes_accessory
				template = no_eyelashes
				value = 0.5
			}
			accessory = {
				mode = modify				
				gene = tails
				template = no_tail
				value = 0.5
			}
			accessory = {
				mode = modify				
				gene = beast_head_attachment_02
				template = no_attachment_02
				value = 0.5
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 200
				is_alive = no
				is_undead = yes
			}
		}
	}	
}
ek_undead_decay_clothes = {
	usage = game
    priority = 49
	undead_clothes_decay = {
		dna_modifiers = {
			morph = {
				mode = add				
				gene = clothes_decay
				template = clothes_decaying
				value = {
					var:ek_undead_decay ?= {value = this}
				}
			}
		}
		weight = {
		 	base = 0
			modifier = {
				add = 200
				is_alive = yes
				is_undead = yes
				has_character_flag = has_decay_value
				var:ek_undead_decay >= 0.2
				NOT = { has_character_modifier = modifier_ritual_conceal }
			}
			modifier = {
				factor = 0
			    exists = character:mannimarco_1000	# too much drip
                this = character:mannimarco_1000	
			}
		}
	}
	undead_clothes_decay_dead_fallback = { # since characters lose variables and flags on death, this will default dead undead characters to appear as skeletons, so that they dont magically restore their skin as soon as they're killed
		dna_modifiers = {
			morph = {
				mode = add				
				gene = clothes_decay
				template = clothes_decaying
				value = 0.7
			}
		}
		weight = {
		 	base = 0
			modifier = {
				add = 200
				is_undead = yes
				is_alive = no
			}
			modifier = {
				factor = 0
			    exists = character:mannimarco_1000	# too much drip
                this = character:mannimarco_1000	
			}
		}
	}
}
ek_undead_receding_hairline = {
	usage = game
    priority = 49
	undead_clothes_decay = {
		dna_modifiers = {
			morph = {
				mode = add				
				gene = hairline_type
				template = receding
				value = {
					var:ek_undead_decay ?= {value = this}
					add = 0.2
				}
			}
		}
		weight = {
		 	base = 0
			modifier = {
				add = 200
				is_undead = yes
				has_character_flag = has_decay_value
				var:ek_undead_decay >= 0.55
				NOT = { has_character_modifier = modifier_ritual_conceal }
			}
		}
	}
}
ek_syl_complexion = {
	usage = game
	priority = 50
	syl_complexion = {
		dna_modifiers = {
			morph = {
				mode = add				
				gene = complexion
				template = complexion_special_syl
				value = 0.89
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 1000
				exists = character:marie_1000
				this = character:marie_1000
			}
		}	
	}
}