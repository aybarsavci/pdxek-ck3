
#########################################
# SECRET TRAITS, RULER DESIGNER			#
#########################################

namespace = ek_secret_trait_event
# Vampire
ek_secret_trait_event.0001 = {
	type = character_event
	content_source = dlc_ek
	title = ek_secret_trait_event.0001.t
	desc = ek_secret_trait_event.0001.desc
	theme = intrigue_skulduggery_focus
	override_background = { reference = corridor_night }

	trigger = {	
		is_from_ruler_designer = yes
		has_trait = vampire_character
	}	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	option = { #secret
		name = ek_secret_trait_event.0001.option1
		flavor =  ek_secret_trait_event.0001.option1.flavor
		add_secret = {
			type = secret_vampire
		}
		retain_visual_age_effect = yes #always do this before adding the immortality trait
		add_character_flag = vampire
		add_trait = reclusive_vampire # we make sure to add the new trait before removing the old, otherwise wacky shit can happen
		remove_trait = vampire_character
		add_character_modifier = secret_vampire_modifier
		hidden_effect = {
			substitute_lifespan_by_immortality_effect = yes #always do this after adding the immortality trait
			custom_tooltip = {
				text = ek_clear_aging_modifier_tt
				clear_aging_modifier_effect = yes
			}
		}	
	}
	option = { #open
		name = ek_secret_trait_event.0001.option2
		flavor =  ek_secret_trait_event.0001.option2.flavor
		retain_visual_age_effect = yes #always do this before adding the immortality trait
		add_character_flag = vampire
		hidden_effect = {
			substitute_lifespan_by_immortality_effect = yes #always do this after adding the immortality trait
			custom_tooltip = {
				text = ek_clear_aging_modifier_tt
				clear_aging_modifier_effect = yes
			}
		}	
	}		
}
# Lycanthrope
ek_secret_trait_event.0002 = {
	type = character_event
	content_source = dlc_ek
	title = ek_secret_trait_event.0002.t
	desc = ek_secret_trait_event.0002.desc
	theme = intrigue_skulduggery_focus
	override_background = { reference = corridor_night }

	trigger = {	
		is_from_ruler_designer = yes
		has_trait = lycan_character
	}	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	option = { #secret
		name = ek_secret_trait_event.0002.option1
		flavor =  ek_secret_trait_event.0002.option1.flavor
		add_secret = {
			type = secret_lycan
		}
		add_character_flag = lycan
		add_trait = irritable_lycan # we make sure to add the new trait before removing the old, otherwise wacky shit can happen
		remove_trait = lycan_character
		add_character_modifier = secret_lycan_modifier
	}
	option = { #open
		name = ek_secret_trait_event.0002.option2
		flavor =  ek_secret_trait_event.0002.option2.flavor
		add_character_flag = lycan
	}		
}
# Necromancer
ek_secret_trait_event.0003 = {
	type = character_event
	content_source = dlc_ek
	title = ek_secret_trait_event.0003.t
	desc = ek_secret_trait_event.0003.desc
	theme = intrigue_skulduggery_focus
	override_background = { reference = corridor_night }

	trigger = {	
		is_from_ruler_designer = yes
		has_trait = necromancer
		NOT = { has_trait = lich_character } #we've previously established that liches reveal their necromancy upon ascension, so you shouldn't be able to also hide this
	}	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	option = { #secret
		name = ek_secret_trait_event.0003.option1
		flavor =  ek_secret_trait_event.0003.option1.flavor
		add_secret = {
			type = secret_necromancer
		}
		add_trait = experimentalist_necromancer # we make sure to add the new trait before removing the old, otherwise wacky shit can happen
		remove_trait = necromancer
	}
	option = { #open
		name = ek_secret_trait_event.0003.option2
		flavor =  ek_secret_trait_event.0003.option2.flavor
	}		
}	

# Liches - not really a secret trait but this gives RD liches the proper flags etc
ek_secret_trait_event.0004 = {
	type = character_event
	content_source = dlc_ek
	hidden = yes

	trigger = {	
		is_from_ruler_designer = yes
		has_trait = lich_character
	}	
	
	immediate = {
		add_character_flag = lich
		set_starting_decay_effect = yes
		clear_aging_modifier_effect = yes
	}
}	


#idk, I felt it was convenient to keep the RD game start events in the same place, so this one also gets to be a secret trait event :-)

# Pirates
ek_secret_trait_event.0005 = {
	type = character_event
	content_source = dlc_ek
	title = ek_secret_trait_event.0005.t
	desc = ek_secret_trait_event.0005.desc
	
	theme = realm
	#Check if you're in the Inner Sea Region, then use the inner_sea background
	override_background = {
		trigger = {
			location = {
				is_sea_province = yes
				geographical_region = sea_inner_sea
			}
		}
		reference = ek_inner_sea
	}
	#Otherwise, use the default ocean background
	override_background = { reference = fp1_ocean }

	trigger = {	
		is_from_ruler_designer = yes # this replaces the game start decision to turn pirate gov
		is_landed = yes
		NOT = { government_has_flag = government_is_pirate } # can't already be pirate otherwise what's the point
		OR = { 
			has_title = title:d_brethren_gold_coast # so either you start as one of the onmap pirate realms with RD
			has_title = title:d_red_sails
			has_title = title:d_regal_pirate
			has_title = title:d_masconian_pirates
			has_title = title:d_ghost_fleet
			has_title = title:d_heartless_horde
			has_title = title:d_yoku_freeport
			has_title = title:d_ruddy_fangs
			has_title = title:d_bonechime_gang
			has_title = title:d_ra_ugakta
			has_title = title:d_napere_do_kotu
			has_title = title:d_sea_vipers
			has_title = title:d_blue_venom
			has_title = title:d_storm_sharks
			has_trait = pirate # or you intentionally picked the pirate trait in RD
		}
	}	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	immediate = {
		primary_title = {
			save_scope_as = primary_title
		}
	}

	option = { # arr matey
		name = ek_secret_trait_event.0005.option1
		flavor =  ek_secret_trait_event.0005.option1.flavor
		change_government = pirate_government
	}
	option = { # nay matey
		name = ek_secret_trait_event.0005.option2
		flavor =  ek_secret_trait_event.0005.option2.flavor
	}		
}

# Daedric Worshippers
ek_secret_trait_event.0006 = {
	type = character_event
	content_source = dlc_ek
	title = ek_secret_trait_event.0006.t
	desc = ek_secret_trait_event.0006.desc
	
	theme = faith
	override_background = { reference = corridor_night }

	trigger = {	
		is_from_ruler_designer = yes
		is_daedra_cultist = yes
	}	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	option = { #secret
		name = ek_secret_trait_event.0006.option1
		
		hidden_effect = { 
			if = {
				limit = { has_trait = azura_worshipper }
				save_scope_value_as = { name = daedric_prince value = flag:azura }
			}
			else_if = {
				limit = { has_trait = boethiah_worshipper }
				save_scope_value_as = { name = daedric_prince value = flag:boethiah }
			}
			else_if = {
				limit = { has_trait = clavicus_worshipper }
				save_scope_value_as = { name = daedric_prince value = flag:clavicus }
			}
			else_if = {
				limit = { has_trait = hermaeus_worshipper }
				save_scope_value_as = { name = daedric_prince value = flag:hermaeus }
			}
			else_if = {
				limit = { has_trait = hircine_worshipper }
				save_scope_value_as = { name = daedric_prince value = flag:hircine }
			}
			else_if = {
				limit = { has_trait = malacath_worshipper }
				save_scope_value_as = { name = daedric_prince value = flag:malacath }
			}
			else_if = {
				limit = { has_trait = mehrunes_worshipper }
				save_scope_value_as = { name = daedric_prince value = flag:mehrunes }
			}
			else_if = {
				limit = { has_trait = mephala_worshipper }
				save_scope_value_as = { name = daedric_prince value = flag:mephala }
			}
			else_if = {
				limit = { has_trait = meridia_worshipper }
				save_scope_value_as = { name = daedric_prince value = flag:meridia }
			}
			else_if = {
				limit = { has_trait = molag_worshipper }
				save_scope_value_as = { name = daedric_prince value = flag:molag }
			}
			else_if = {
				limit = { has_trait = namira_worshipper }
				save_scope_value_as = { name = daedric_prince value = flag:namira }
			}
			else_if = {
				limit = { has_trait = nocturnal_worshipper }
				save_scope_value_as = { name = daedric_prince value = flag:nocturnal }
			}
			else_if = {
				limit = { has_trait = peryite_worshipper }
				save_scope_value_as = { name = daedric_prince value = flag:peryite }
			}
			else_if = {
				limit = { has_trait = sanguine_worshipper }
				save_scope_value_as = { name = daedric_prince value = flag:sanguine }
			}
			else_if = {
				limit = { has_trait = sheogorath_worshipper }
				save_scope_value_as = { name = daedric_prince value = flag:sheogorath }
			}
			else_if = {
				limit = { has_trait = vaermina_worshipper }
				save_scope_value_as = { name = daedric_prince value = flag:vaermina }
			}
			crypto_religion_cultural_variant_effect = yes
		}
		make_character_crypto_religionist_effect = { CRYPTO_RELIGION = scope:daedric_faith }

		remove_trait = azura_worshipper
		remove_trait = boethiah_worshipper
		remove_trait = clavicus_worshipper
		remove_trait = hermaeus_worshipper
		remove_trait = hircine_worshipper
		remove_trait = malacath_worshipper
		remove_trait = mehrunes_worshipper
		remove_trait = mephala_worshipper
		remove_trait = meridia_worshipper
		remove_trait = molag_worshipper
		remove_trait = namira_worshipper
		remove_trait = nocturnal_worshipper
		remove_trait = peryite_worshipper
		remove_trait = sanguine_worshipper
		remove_trait = sheogorath_worshipper
		remove_trait = vaermina_worshipper

	}
	option = { #open
		name = ek_secret_trait_event.0006.option2
		add_piety = medium_piety_gain
	}		
}