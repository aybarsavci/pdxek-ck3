#EK NOTE: funerals events for EK burial traditions
namespace = ek_funeral

#Argonian wonders about reincarnation
ek_funeral.0001 = {
	type = activity_event
	content_source = dlc_ek
	title = ek_funeral.0001.t
	desc = ek_funeral.0001.desc
	theme = funeral_activity
	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		character = scope:deceased
		animation = dead
	}
	cooldown = { years = 10 }

	trigger = {
		is_ai = no # This is a flavour event, no need to run it on AI
		this = scope:host #Host
		faith = { has_doctrine_parameter = grave_stake_funeral } #Only for Hist people
		scope:deceased = { faith = { has_doctrine_parameter = grave_stake_funeral } } #Deceased needs to be Hist person too
	}
	option = { #Deceased will be great chief - get dynasty prestige
		name = ek_funeral.0001.a
		root.dynasty = { add_dynasty_prestige = 150 }
	}
	option = { #Deceased will be warrior - get prestige
		name = ek_funeral.0001.b
		add_prestige = 150
	}
	option = { #Deceased will be tree-minder - get piety
		name = ek_funeral.0001.c
		add_piety = 150
	}
}
#Grave-singer wants to harvest bones scales
ek_funeral.0002 = {
	type = activity_event
	content_source = dlc_ek
	title = ek_funeral.0002.t
	desc = ek_funeral.0002.desc
	theme = funeral_activity
	left_portrait = {
		character = root
		animation = grief
	}
	right_portrait = {
		character = scope:deceased
		animation = dead
	}
	cooldown = { years = 10 }
	trigger = {
		is_ai = no # This is a flavour event, no need to run it on AI
		this = scope:host #Host
		faith = { has_doctrine_parameter = grave_stake_funeral } #Only for Hist people
		#Using heritage, because can't check dead people for race flag
		scope:deceased.culture = { has_cultural_pillar = heritage_argonian } #Loc talks about scales
		NOT = { culture =  { has_cultural_tradition = tradition_naga_underworld } } #Harvesting bones and scales is normal for nagas
		any_character_artifact = {
			artifact_slot_type = primary_armament
			is_equipped = yes
			NOR = {
				has_artifact_modifier = artifact_prowess_4_modifier
				has_artifact_modifier = artifact_prowess_5_modifier
				has_artifact_modifier = artifact_prowess_6_modifier
			}
		}
	}
	immediate = {
		random_character_artifact = {
			limit = {
				artifact_slot_type = primary_armament
				is_equipped = yes
			}
			save_scope_as = scale_artifact	
		}
	}
	option = { #Agree to harvesting, get small buff
		name = ek_funeral.0002.a
		add_piety = -250
		custom_tooltip = {
			text = scales_improve_weapon.tt
			scope:scale_artifact = {
				add_artifact_modifier = artifact_prowess_3_modifier
			}
		}
	}
	option = { #Refuse harvesting
		name = ek_funeral.0002.b
		add_piety = 150
	}
}
#People debate about where argonian is going after death
ek_funeral.0003 = {
	type = activity_event
	content_source = dlc_ek
	title = ek_funeral.0003.t
	desc = ek_funeral.0003.desc
	theme = funeral_activity
	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		character = scope:deceased
		animation = dead
	}
	lower_left_portrait = {
		character = scope:not_hist_mourner
		animation = anger
	}
	lower_right_portrait = {
		character = scope:hist_mourner
		animation = anger
	}
	cooldown = { years = 10 }
	trigger = {
		is_ai = no # This is a flavour event, no need to run it on AI
		faith = { has_doctrine = doctrine_pantheon_hist } #Must be hist faith
		scope:deceased = { NOT = { faith = { has_doctrine = doctrine_pantheon_hist } } } #Deceased is not hist
		scope:deceased.culture = { has_cultural_pillar = heritage_argonian } #Deceased is argonian
	}
	immediate = {
		scope:activity = {
			random_attending_character = {
				limit = {
					NOT = {
						this = root
					}
					is_ai = yes
					is_adult = yes
				}
				weight = {
					base = 1
					modifier = {
						add = 100
						OR = {
							has_trait = cynical
							has_trait = education_learning
						}
					}
				}
				save_scope_as = not_hist_mourner
			}
			random_attending_character = {
				limit = {
					NOT = {
						this = root
						this = scope:not_hist_mourner
					}
					is_ai = yes
					is_adult = yes
				}
				weight = {
					base = 1
					modifier = {
						add = 100
						OR = {
							has_trait = zealous
						}
					}
				}
				save_scope_as = hist_mourner
			}
		}
	}
	option = { #Agree with person who doesn't think deceased's soul is going to hist
		name = ek_funeral.0003.a
		progress_towards_friend_effect = {
			REASON = friend_comforted_at_funeral
			CHARACTER = scope:not_hist_mourner
			OPINION = default_friend_opinion
		}
		add_prestige = 50
	}
	option = { #Agree with person who thinks deceased's soul is going to Hist
		name = ek_funeral.0003.b
		progress_towards_friend_effect = {
			REASON = friend_comforted_at_funeral
			CHARACTER = scope:hist_mourner
			OPINION = default_friend_opinion
		}
		add_piety = 50
	}
}
#Green Pact doesn't want to eat
ek_funeral.0004 = {
	type = activity_event
	content_source = dlc_ek
	title = ek_funeral.0004.t
	desc = ek_funeral.0004.desc
	theme = funeral_activity
	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		character = scope:gp_nothungry
		animation = worry
	}
	cooldown = { years = 10 }
	trigger = {
		is_ai = no # This is a flavour event, no need to run it on AI
		this = scope:host #Host
		faith = { has_doctrine_parameter = green_pact_funeral}
	}
	immediate = {
		scope:activity = {
			random_attending_character = {
				limit = {
					NOT = {
						this = root
					}
					is_ai = yes
					is_adult = yes
					faith = { has_doctrine_parameter = green_pact_funeral}
					NOT = { has_trait = zealous }
				}
				weight = {
					base = 1
					modifier = {
						add = 100
						OR = {
							has_trait = cynical
						}
					}
				}
				save_scope_as = gp_nothungry
			}
		}
	}
	option = { #Force them to eat
		name = ek_funeral.0004.a
		add_piety = 150
		add_legitimacy_effect = { LEGITIMACY = minor_legitimacy_gain }
		progress_towards_rival_effect = {
			REASON = rival_insulted_at_funeral
			CHARACTER = scope:gp_nothungry
			OPINION = default_rival_opinion
		}
	}
	option = { #Don't force them to eat
		name = ek_funeral.0004.b
		progress_towards_friend_effect = {
			REASON = friend_comforted_at_funeral
			CHARACTER = scope:gp_nothungry
			OPINION = default_friend_opinion
		}
		add_piety = -250
	}
}
#Green Pact claims deceased can't be eaten
ek_funeral.0005 = {
	type = activity_event
	content_source = dlc_ek
	title = ek_funeral.0005.t
	desc = ek_funeral.0005.desc
	theme = funeral_activity
	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		character = scope:gp_opponent
		animation = anger
	}
	cooldown = { years = 10 }
	trigger = {
		is_ai = no # This is a flavour event, no need to run it on AI
		this = scope:host #Host
		faith = { has_doctrine_parameter = green_pact_funeral}
		scope:deceased ={ NOT = { faith = { has_doctrine_parameter = green_pact_funeral } } }
	}
	immediate = {
		scope:activity = {
			random_attending_character = {
				limit = {
					NOT = {
						this = root
					}
					is_ai = yes
					is_adult = yes
					faith = { has_doctrine_parameter = green_pact_funeral}
					NOT = { has_trait = zealous }
				}
				weight = {
					base = 1
					modifier = {
						add = 100
						OR = {
							has_trait = compassionate
							has_trait = cynical
						}
					}
				}
				save_scope_as = gp_opponent
			}
		}
	}
	option = { #Disregard their claims
		name = ek_funeral.0005.a
		add_piety = -150
		add_legitimacy_effect = { LEGITIMACY = minor_legitimacy_gain }
		progress_towards_rival_effect = {
			REASON = rival_insulted_at_funeral
			CHARACTER = scope:gp_opponent
			OPINION = default_rival_opinion
		}
	}
	option = { #Agree with them
		name = ek_funeral.0005.b
		add_character_flag = {
			flag = stopped_funeral
			years = 1
		}
		add_piety = 150
	}
}
#Forge-wife asking what to reforge ashes into
ek_funeral.0006 = {
	type = activity_event
	content_source = dlc_ek
	title = ek_funeral.0006.t
	desc = ek_funeral.0006.desc
	theme = funeral_activity
	left_portrait = {
		character = root
		animation = crying
	}
	right_portrait = {
		character = scope:forgewife
		animation = anger
	}
	cooldown = { years = 10 }
	trigger = {
		is_ai = no # This is a flavour event, no need to run it on AI
		this = scope:host #Host
		faith = {
			has_doctrine_parameter = cremation_funeral 
		}
		employs_court_position = forgewife_court_position
		any_character_artifact = {
			artifact_slot_type = primary_armament
			is_equipped = yes
			NOR = {
				has_artifact_modifier = artifact_monthly_prestige_3_modifier
				has_artifact_modifier = artifact_monthly_prestige_4_modifier
			}
		}
	}
	immediate = {
		if = {
			limit = {
				exists = court_position:forgewife_court_position
			}
			court_position:forgewife_court_position = { save_scope_as = forgewife }
		}
		random_character_artifact = {
			limit = {
				artifact_slot_type = primary_armament
				is_equipped = yes
				NOR = {
					has_artifact_modifier = artifact_monthly_prestige_3_modifier
					has_artifact_modifier = artifact_monthly_prestige_4_modifier
				}
			}
			save_scope_as = ash_weapon_artifact
		}
		
	}
	option = { #Mix ashes into a weapon
		name = ek_funeral.0006.a
		custom_tooltip = {
			text = ash_weapon_improved
			scope:ash_weapon_artifact = {
				add_artifact_modifier = artifact_monthly_prestige_2_modifier
			}
		}
		add_character_flag = {
			flag = forging_sword
			years = 1
		}
	}
	option = { #Lose stress
		name = ek_funeral.0006.b
		add_stress = medium_stress_loss
		add_piety = minor_piety_loss
	}
}